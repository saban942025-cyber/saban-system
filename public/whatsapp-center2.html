<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Saban Command Center ğŸš€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; color: white; height: 100vh; display: flex; overflow: hidden; font-family: system-ui; }
        
        /* ××–×•×¨ ×”×”×–×× ×•×ª (Feed) */
        .orders-feed { width: 350px; background: #1e293b; border-left: 1px solid #334155; display: flex; flex-direction: column; }
        .feed-content { flex: 1; overflow-y: auto; padding: 15px; }
        
        .order-card { 
            background: #334155; border-radius: 12px; padding: 15px; margin-bottom: 12px; 
            border: 1px solid #475569; animation: slideIn 0.3s;
        }
        .order-card.new { border-right: 4px solid #10b981; }

        /* ×œ×•×— ×”×¤×ª×§×™× (Canvas) */
        .board { flex: 1; position: relative; background: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; overflow: hidden; }
        
        .sticky-note {
            position: absolute; width: 220px; min-height: 180px;
            background: #fef3c7; color: #333;
            border-radius: 8px; padding: 15px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            cursor: grab; transition: transform 0.1s;
            display: flex; flex-direction: column;
        }
        .sticky-note:active { cursor: grabbing; transform: scale(1.02); z-index: 100 !important; }
        .sticky-note textarea { background: transparent; border: none; outline: none; resize: none; width: 100%; flex: 1; font-family: 'Comic Sans MS', sans-serif; }
        
        .note-header { display: flex; justify-content: space-between; margin-bottom: 8px; cursor: grab; }
        .note-colors { display: flex; gap: 5px; opacity: 0; transition: 0.2s; }
        .sticky-note:hover .note-colors { opacity: 1; }
        .color-dot { width: 12px; height: 12px; rounded-full; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); }

        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

    <div class="orders-feed">
        <div class="p-4 border-b border-slate-700 bg-slate-900 flex justify-between items-center">
            <h2 class="font-bold flex items-center gap-2"><i class="fas fa-satellite-dish text-green-400"></i> LIVE FEED</h2>
            <span id="orderCount" class="bg-red-500 text-xs px-2 py-1 rounded-full font-bold">0</span>
        </div>
        <div id="ordersList" class="feed-content">
            <div class="text-center text-slate-500 mt-10">×××ª×™×Ÿ ×œ×”×–×× ×•×ª...</div>
        </div>
    </div>

    <div class="board" id="board" ondrop="drop(event)" ondragover="allowDrop(event)">
        
        <button onclick="addNote()" class="absolute top-5 right-5 bg-blue-600 hover:bg-blue-500 text-white w-12 h-12 rounded-full shadow-lg text-xl z-50 transition hover:scale-110">
            <i class="fas fa-plus"></i>
        </button>

        <div class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">
            <h1 class="text-9xl font-black text-slate-500">SABAN</h1>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const { jsPDF } = window.jspdf;

        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. ×”××–× ×” ×œ×”×–×× ×•×ª ×‘×–××Ÿ ×××ª
        onSnapshot(collection(db, "orders"), (snap) => {
            const list = document.getElementById('ordersList');
            const orders = snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => b.createdAt - a.createdAt);
            
            document.getElementById('orderCount').innerText = orders.length;
            list.innerHTML = '';

            orders.forEach(o => {
                const date = o.createdAt?.seconds ? new Date(o.createdAt.seconds * 1000).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '×¢×›×©×™×•';
                const div = document.createElement('div');
                div.className = `order-card ${o.status === 'new' ? 'new' : ''}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="font-bold text-lg">${o.project}</div>
                            <div class="text-xs text-slate-400">${date}</div>
                        </div>
                        <div class="bg-slate-700 px-2 py-1 rounded text-xs">${o.items.length} ×¤×¨×™×˜×™×</div>
                    </div>
                    <div class="text-sm text-slate-300 mb-3 space-y-1">
                        ${o.items.map(i => `<div>â€¢ ${i.name}</div>`).join('')}
                    </div>
                    <div class="flex gap-2 mt-2">
                        <button onclick="printOrder('${o.project}')" class="flex-1 bg-slate-600 hover:bg-slate-500 py-1 rounded text-xs font-bold"><i class="fas fa-print"></i> ×”×“×¤×¡</button>
                        <button onclick="downloadPDF('${o.project}')" class="flex-1 bg-green-700 hover:bg-green-600 py-1 rounded text-xs font-bold"><i class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                `;
                list.appendChild(div);
            });
        });

        // 2. ×¤×ª×§×™×•×ª ×’×¨×™×¨×•×ª (Draggable Notes)
        window.addNote = (text = "××©×™××” ×—×“×©×”...") => {
            const board = document.getElementById('board');
            const note = document.createElement('div');
            note.className = 'sticky-note';
            note.style.left = Math.random() * 400 + 'px';
            note.style.top = Math.random() * 400 + 'px';
            note.style.backgroundColor = '#fef3c7'; // ×¦×”×•×‘ ×‘×¨×™×¨×ª ××—×“×œ
            
            note.innerHTML = `
                <div class="note-header" onmousedown="startDrag(event, this.parentElement)">
                    <i class="fas fa-thumbtack text-slate-400"></i>
                    <div class="note-colors">
                        <div class="color-dot bg-red-200" onclick="setColor(this, '#fecaca')"></div>
                        <div class="color-dot bg-green-200" onclick="setColor(this, '#bbf7d0')"></div>
                        <div class="color-dot bg-yellow-200" onclick="setColor(this, '#fef3c7')"></div>
                    </div>
                </div>
                <textarea oninput="autoTitle(this)">${text}</textarea>
                <button onclick="this.parentElement.remove()" class="absolute bottom-2 left-2 text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button>
            `;
            board.appendChild(note);
        };

        // ×œ×•×’×™×§×ª ×’×¨×™×¨×”
        let draggedNote = null;
        let offsetX, offsetY;

        window.startDrag = (e, note) => {
            draggedNote = note;
            offsetX = e.clientX - note.getBoundingClientRect().left;
            offsetY = e.clientY - note.getBoundingClientRect().top;
            
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', stopDrag);
        };

        function onDrag(e) {
            if (!draggedNote) return;
            draggedNote.style.left = (e.clientX - offsetX) + 'px';
            draggedNote.style.top = (e.clientY - offsetY) + 'px';
        }

        function stopDrag() {
            draggedNote = null;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', stopDrag);
        }

        window.setColor = (dot, color) => {
            dot.closest('.sticky-note').style.backgroundColor = color;
        };

        window.autoTitle = (textarea) => {
            // ×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£ ×œ×•×’×™×§×” ×œ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª ×“×™× ××™×ª
        };

        // 3. ×”×“×¤×¡×” ×•-PDF
        window.printOrder = (title) => {
            alert("×©×•×œ×— ×œ××“×¤×¡×ª ×‘××©×¨×“... ğŸ–¨ï¸\n×”×–×× ×”: " + title);
        };

        window.downloadPDF = (title) => {
            const doc = new jsPDF();
            doc.text("Saban Order: " + title, 10, 10);
            doc.save(title + ".pdf");
        };

        // ×¤×ª×§ ×¨××©×•×Ÿ ×œ×“×•×’××”
        setTimeout(() => addNote("×œ×”×ª×§×©×¨ ×œ×©×—×¨ ×œ×’×‘×™ ×”××œ×˜"), 500);

    </script>
</body>
</html>
