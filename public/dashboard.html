<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saban Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- עיצוב זכוכית פרימיום כהה --- */
        body { 
            background: #0f172a; /* Slate 900 */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh; padding: 20px; padding-bottom: 100px;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* אנימציות */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        /* כרטיסי זכוכית */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* כפתורי אפליקציה */
        .app-btn {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            padding: 16px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px;
            cursor: pointer; transition: all 0.2s;
            position: relative; overflow: hidden;
            height: 110px;
        }
        .app-btn:active { transform: scale(0.96); background: rgba(255,255,255,0.1); }
        
        /* אייקונים זוהרים */
        .icon-box {
            width: 48px; height: 48px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; color: white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .g-green { background: linear-gradient(135deg, #22c55e, #14532d); }
        .g-blue { background: linear-gradient(135deg, #3b82f6, #1e3a8a); }
        .g-purple { background: linear-gradient(135deg, #a855f7, #581c87); }
        .g-orange { background: linear-gradient(135deg, #f97316, #7c2d12); }
        .g-slate { background: linear-gradient(135deg, #64748b, #334155); }

        /* כותרת מקובעת חכמה */
        .smart-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 24px; padding-top: 10px;
        }
        .refresh-btn { 
            width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); 
            display: flex; align-items: center; justify-content: center; font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="smart-header fade-in" style="animation-delay: 0ms;">
        <div onclick="window.location.reload()">
            <div class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">מערכת הפעלה</div>
            <div class="text-2xl font-black text-white flex items-center gap-2">
                Saban<span class="text-blue-500">OS</span>
            </div>
        </div>
        <div class="text-right">
            <div id="clock" class="text-xl font-mono font-bold text-white">00:00</div>
            <div id="date" class="text-[10px] text-gray-400 font-bold uppercase">...</div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 fade-in" style="animation-delay: 100ms;">
        
        <div class="app-btn" onclick="openParentApp('chat', 'מרכז תקשורת')">
            <div class="icon-box g-green"><i class="fab fa-whatsapp"></i></div>
            <div class="text-center">
                <div class="font-bold text-sm">מרכז תקשורת</div>
                <div class="text-[10px] text-gray-400">צ'אט, קבוצות</div>
            </div>
        </div>

        <div class="app-btn" onclick="openParentApp('drive', 'ארכיון מסמכים')">
            <div class="icon-box g-blue"><i class="fas fa-folder-open"></i></div>
            <div class="text-center">
                <div class="font-bold text-sm">ארכיון מסמכים</div>
                <div class="text-[10px] text-gray-400">דרייב, חשבוניות</div>
            </div>
        </div>

        <div class="app-btn" onclick="openParentApp('tasks', 'משימות וסידור')">
            <div class="icon-box g-purple"><i class="fas fa-tasks"></i></div>
            <div class="text-center">
                <div class="font-bold text-sm">משימות</div>
                <div class="text-[10px] text-gray-400">יואב, סידור</div>
            </div>
        </div>

        <div class="app-btn" onclick="window.parent.sendMagicLink()">
            <div class="icon-box g-orange"><i class="fas fa-magic"></i></div>
            <div class="text-center">
                <div class="font-bold text-sm">לינק קסם</div>
                <div class="text-[10px] text-gray-400">שליחת הזמנה</div>
            </div>
        </div>

    </div>

    <div class="mt-6 fade-in" style="animation-delay: 200ms;">
        <h3 class="text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider">סטטוס מערכת</h3>
        
        <div class="glass-panel p-4 flex items-center justify-between mb-3" onclick="openParentApp('staff', 'צוות אונליין')">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700">
                    <i class="fas fa-users text-blue-400"></i>
                </div>
                <div>
                    <div class="font-bold text-sm">צוות אונליין</div>
                    <div class="text-[10px] text-green-400 font-bold flex items-center gap-1">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                        <span id="staff-count">טוען...</span> מחוברים
                    </div>
                </div>
            </div>
            <i class="fas fa-chevron-left text-gray-600"></i>
        </div>

        <div class="glass-panel p-4 flex items-center justify-between" onclick="openParentApp('truck', 'מסוף נהג')">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700">
                    <i class="fas fa-truck text-orange-400"></i>
                </div>
                <div>
                    <div class="font-bold text-sm">נהגים פעילים</div>
                    <div class="text-[10px] text-gray-400">מעקב משימות</div>
                </div>
            </div>
            <i class="fas fa-chevron-left text-gray-600"></i>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));

        // פונקציה לתקשורת עם המעטפת (Shell)
        window.openParentApp = (id, title) => {
            if (window.parent && window.parent.openApp) {
                window.parent.openApp(id, title);
            } else {
                console.warn('לא נמצא הורה (Shell). מנסה לנווט ישירות...');
                // Fallback למקרה שפותחים את הקובץ ישירות
                let url = '';
                if(id === 'chat') url = 'comm-center.html';
                if(id === 'drive') url = 'documents-drive.html';
                if(url) window.location.href = url;
            }
        };

        // שעון
        function updateTime() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('he-IL', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('date').innerText = now.toLocaleDateString('he-IL', {weekday: 'long', day: 'numeric', month: 'short'});
        }
        setInterval(updateTime, 1000);
        updateTime();

        // מונה צוות
        onSnapshot(query(collection(db, "users")), (snap) => {
            document.getElementById('staff-count').innerText = snap.size;
        });
    </script>
</body>
</html>
