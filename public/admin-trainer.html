<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Saban Brain Studio Pro ğŸ§ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; height: 100vh; display: flex; flex-direction: column; font-family: system-ui; }
        
        /* Layout */
        .studio-layout { display: grid; grid-template-columns: 280px 1fr 360px; height: 100%; overflow: hidden; }
        
        /* Sidebar (Brain List) */
        .brain-list { background: #1e293b; border-left: 1px solid #334155; overflow-y: auto; }
        .brain-item { padding: 15px; border-bottom: 1px solid #334155; cursor: pointer; transition: 0.2s; border-right: 3px solid transparent; }
        .brain-item:hover { background: #334155; }
        .brain-item.active { background: #1e293b; border-right-color: #10b981; background: #0f172a; }
        
        /* Editor (Center) */
        .editor-area { padding: 30px; overflow-y: auto; background: #0f172a; }
        .editor-card { background: #1e293b; padding: 25px; border-radius: 12px; border: 1px solid #334155; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        /* Toolbar */
        .toolbar { display: flex; gap: 8px; margin-bottom: 10px; padding: 8px; background: #334155; border-radius: 8px; flex-wrap: wrap; }
        .tool-btn { background: #475569; border: none; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
        .tool-btn:hover { background: #64748b; transform: translateY(-1px); }
        .tool-btn i { font-size: 14px; }

        /* Simulator (Left) */
        .sim-panel { background: #1e293b; border-right: 1px solid #334155; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .phone-mockup { 
            width: 300px; height: 600px; background: #fff; border-radius: 35px; border: 10px solid #000; 
            overflow: hidden; position: relative; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .phone-header { background: #4f46e5; color: white; padding: 15px; font-weight: bold; text-align: center; font-size: 14px; }
        .phone-body { flex: 1; background: #eef2ff; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        /* Chat Bubbles */
        .bubble { padding: 10px 14px; border-radius: 12px; font-size: 13px; max-width: 85%; width: fit-content; line-height: 1.4; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .bubble-bot { background: #fff; border-top-right-radius: 0; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .bubble-user { background: #4f46e5; border-top-left-radius: 0; color: white; align-self: flex-end; }
        .bubble-btn { background: #e0e7ff; color: #4338ca; padding: 8px; border-radius: 8px; text-align: center; font-weight: bold; margin-top: 5px; cursor: pointer; border: 1px solid #c7d2fe; display: block; width: 100%; transition: 0.2s; }
        .bubble-btn:hover { background: #c7d2fe; }
        
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        /* Inputs */
        input, textarea { background: #0f172a; border: 1px solid #475569; color: white; padding: 10px; border-radius: 6px; width: 100%; outline: none; }
        input:focus, textarea:focus { border-color: #10b981; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
    </style>
</head>
<body>

    <header class="h-16 bg-slate-900 border-b border-slate-700 flex items-center justify-between px-6 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-xl shadow-lg shadow-indigo-500/20">ğŸ§ </div>
            <div>
                <h1 class="font-bold text-lg tracking-wide">Saban Brain Studio</h1>
                <div class="text-[10px] text-emerald-400 font-mono">ONLINE â— v2.0</div>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="saveChanges()" class="bg-emerald-600 hover:bg-emerald-500 px-6 py-2 rounded-lg font-bold transition flex items-center gap-2 shadow-lg shadow-emerald-900/20">
                <i class="fas fa-save"></i> ×©××•×¨ ××•×—
            </button>
        </div>
    </header>

    <div class="studio-layout">
        
        <div class="brain-list custom-scroll">
            <div class="p-4 border-b border-slate-700 sticky top-0 bg-slate-800 z-10 flex justify-between items-center">
                <span class="font-bold text-sm text-slate-300">× ×•×©××™× ×‘××¢×¨×›×ª</span>
                <button onclick="createNewTopic()" class="text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded"><i class="fas fa-plus"></i> ×—×“×©</button>
            </div>
            <div id="topicsContainer">
                </div>
        </div>

        <div class="editor-area custom-scroll">
            <div id="editorPanel" class="editor-card hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-edit text-indigo-400"></i> ×¢×¨×™×›×ª × ×•×©×</h2>
                    <button onclick="deleteTopic()" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ××—×§ × ×•×©×</button>
                </div>

                <div class="mb-6">
                    <label>× ×•×©× ×›×œ×œ×™ (×œ×¡×™×•×•×’)</label>
                    <input type="text" id="editTopic" placeholder="×œ××©×œ: ××™×˜×•×, ×× ×”×œ×”...">
                </div>

                <div class="mb-6">
                    <label>××™×œ×•×ª ××¤×ª×— (××•×¤×¨×“×•×ª ×‘×¤×¡×™×§)</label>
                    <input type="text" id="editKeywords" placeholder="×œ××©×œ: ×¡×™×§×”, ×¨×˜×™×‘×•×ª, ×‘×¨×™×›×”">
                    <div class="text-xs text-slate-500 mt-1">××™×œ×™× ××œ×• ×™×¤×¢×™×œ×• ××ª ×”×ª×©×•×‘×”</div>
                </div>

                <div class="mb-6">
                    <label>×ª×©×•×‘×ª ×”×‘×•×˜</label>
                    <div class="toolbar">
                        <button class="tool-btn" onclick="insertText('**', '**')"><i class="fas fa-bold"></i> ×”×“×’×©</button>
                        <button class="tool-btn" onclick="insertEmoji('ğŸ˜Š')"><i class="far fa-smile"></i> ××™××•×’'×™</button>
                        <button class="tool-btn bg-indigo-600 hover:bg-indigo-500" onclick="addSimulatorButton()"><i class="fas fa-bullseye"></i> ×”×•×¡×£ ×›×¤×ª×•×¨</button>
                        <button class="tool-btn bg-orange-600 hover:bg-orange-500" onclick="insertText('{name}')"><i class="fas fa-user-tag"></i> ×©× ×œ×§×•×—</button>
                        <button class="tool-btn bg-blue-600 hover:bg-blue-500" onclick="insertTagStaff()"><i class="fas fa-headset"></i> ×ª×™×™×’ ×¦×•×•×ª</button>
                        <button class="tool-btn bg-red-600 hover:bg-red-500" onclick="insertVideo()"><i class="fab fa-youtube"></i> ×•×™×“××•</button>
                    </div>
                    
                    <textarea id="editAnswer" class="h-40 font-mono text-sm leading-relaxed" placeholder="×”×ª×©×•×‘×” ×©×”×œ×§×•×— ×™×§×‘×œ..."></textarea>
                </div>

                <div class="mb-6 border-t border-slate-700 pt-4">
                    <label>×›×¤×ª×•×¨×™× ××™× ×˜×¨××§×˜×™×‘×™×™× (JSON)</label>
                    <div class="text-xs text-slate-400 mb-2">×¢×¨×•×š ×™×“× ×™×ª ××• ×”×©×ª××© ×‘×¡×¨×’×œ ×”×›×œ×™× ×œ×”×•×¡×¤×”</div>
                    <textarea id="editButtons" class="h-24 font-mono text-xs text-green-400 bg-black/30" placeholder="[]"></textarea>
                </div>
            </div>
            
            <div id="welcomeMsg" class="text-center text-slate-500 mt-20">
                <i class="fas fa-brain text-6xl mb-4 opacity-20"></i>
                <p>×‘×—×¨ × ×•×©× ××¦×“ ×™××™×Ÿ ××• ×¦×•×¨ ×—×“×© ×›×“×™ ×œ×”×ª×—×™×œ ×œ×××Ÿ</p>
            </div>
        </div>

        <div class="sim-panel">
            <h3 class="font-bold mb-4 text-sm uppercase tracking-wider text-slate-400">×ª×¦×•×’×” ××§×“×™××” (×œ×§×•×—)</h3>
            <div class="phone-mockup">
                <div class="phone-header">
                    <div class="flex justify-between">
                        <span>ğŸ¤– ×¦'××˜-×¡×‘×Ÿ</span>
                        <span class="text-xs font-normal opacity-80">××—×•×‘×¨</span>
                    </div>
                </div>
                <div class="phone-body" id="simScreen">
                    <div class="bubble bubble-bot">××”×œ×Ÿ! ×× ×™ ×”××•×— ×©××ª×” ×¢×•×¨×š ×›×¨×’×¢. ğŸ‘‹<br>×›×œ ×©×™× ×•×™ ×©×ª×¢×©×” ×‘××¨×›×– - ×™×•×¤×™×¢ ×›××Ÿ ××™×“.</div>
                </div>
                <div class="bg-white p-3 border-t flex gap-2">
                    <input type="text" id="simInput" class="bg-gray-100 text-black border-none rounded-full text-xs px-3" placeholder="×©××œ ××•×ª×™..." onkeydown="if(event.key==='Enter') testBot()">
                    <button onclick="testBot()" class="text-indigo-600"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            
            <div class="mt-6 w-full max-w-[300px]">
                <div class="bg-slate-700/50 p-3 rounded text-xs text-slate-300">
                    <strong>×˜×™×¤ ×œ××××Ÿ:</strong><br>
                    × ×¡×” ×œ×©××•×œ ×‘×¡×™××•×œ×˜×•×¨ ××ª ××™×œ×•×ª ×”××¤×ª×— ×©×¢×¨×›×ª ×›×“×™ ×œ×¨××•×ª ×× ×”×‘×•×˜ "×ª×•×¤×¡" ××•×ª×Ÿ.
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- × ×ª×•× ×™ ×”××•×— (×”×“××™×” ×©×œ ×”×§×•×‘×¥ brain-trainer.js) ---
        let brainData = [
            {
                id: 1,
                topic: "××™×˜×•×",
                keywords: ["××™×˜×•×", "×××‘×˜×™×”", "×¡×™×§×”"],
                answer: "×œ××™×˜×•× ××§×¦×•×¢×™ ×‘×—×“×¨×™× ×¨×˜×•×‘×™×, ×”×”××œ×¦×” ×©×œ×™ ×”×™× **×¡×™×§×” 107** (××™×˜×•× ×¦×× ×˜×™) ×‘×©×ª×™ ×©×›×‘×•×ª. ğŸ›¡ï¸",
                buttons: [{ label: "×”×¦×’ ×¡×™×§×” 107", payload: "SHOW_SIKA" }]
            },
            {
                id: 2,
                topic: "×× ×”×œ×”",
                keywords: ["×—×©×‘×•× ×™×ª", "×”×¨××œ"],
                answer: "××™×Ÿ ×‘×¢×™×” {name}. ×× ×™ ×¤×•×ª×— ××©×™××” ×œ×”×¨××œ (×›×¡×¤×™×) ×©×™×©×œ×— ×œ×š ××ª ×–×”. ğŸ§¾",
                buttons: [{ label: "×“×—×•×£ ×œ××¢\"× ğŸ”¥", payload: "URGENT" }]
            }
        ];

        let activeId = null;

        // --- ××ª×—×•×œ ---
        window.onload = () => {
            renderList();
        };

        // --- ×¨×©×™××ª × ×•×©××™× ---
        function renderList() {
            const container = document.getElementById('topicsContainer');
            container.innerHTML = brainData.map(item => `
                <div onclick="loadTopic(${item.id})" class="brain-item ${activeId === item.id ? 'active' : ''}">
                    <div class="font-bold text-sm text-slate-200">${item.topic}</div>
                    <div class="text-xs text-slate-500 truncate">${item.keywords.join(', ')}</div>
                </div>
            `).join('');
        }

        // --- ×˜×¢×™× ×ª ×¢×•×¨×š ---
        window.loadTopic = (id) => {
            activeId = id;
            const data = brainData.find(i => i.id === id);
            
            document.getElementById('welcomeMsg').classList.add('hidden');
            document.getElementById('editorPanel').classList.remove('hidden');
            
            document.getElementById('editTopic').value = data.topic;
            document.getElementById('editKeywords').value = data.keywords.join(', ');
            document.getElementById('editAnswer').value = data.answer;
            document.getElementById('editButtons').value = JSON.stringify(data.buttons || [], null, 2);
            
            renderList(); // Update active state
            updateSim(data.answer, data.buttons); // Preview immediately
        };

        // --- ×›×œ×™ ×¢×¨×™×›×” (Toolbar) ---
        window.insertText = (text) => {
            const el = document.getElementById('editAnswer');
            const start = el.selectionStart;
            const end = el.selectionEnd;
            const val = el.value;
            el.value = val.substring(0, start) + text + val.substring(end);
            el.focus();
        };

        window.insertEmoji = (emoji) => insertText(emoji);
        
        window.insertTagStaff = () => {
            const currentBtns = JSON.parse(document.getElementById('editButtons').value || '[]');
            currentBtns.push({ label: "×“×‘×¨ ×¢× ×¨××™ ğŸ‘¨â€ğŸ’»", payload: "CALL_RAMI" });
            document.getElementById('editButtons').value = JSON.stringify(currentBtns, null, 2);
            insertText("\n(×”×•×¡×¤×ª×™ ×›×¤×ª×•×¨ ×œ×¤× ×™×™×” ×œ×¦×•×•×ª)");
        };

        window.insertVideo = () => {
            insertText("\nğŸ¬ ×”× ×” ×¡×¨×˜×•×Ÿ ×”×¡×‘×¨: [VIDEO: youtube_id]");
        };

        window.addSimulatorButton = () => {
            const currentBtns = JSON.parse(document.getElementById('editButtons').value || '[]');
            currentBtns.push({ label: "×›×¤×ª×•×¨ ×—×“×© âœ¨", payload: "NEW_ACTION" });
            document.getElementById('editButtons').value = JSON.stringify(currentBtns, null, 2);
        };

        // --- ×¡×™××•×œ×˜×•×¨ ---
        window.updateSim = (text, buttons) => {
            const screen = document.getElementById('simScreen');
            // × ×§×” ×”×•×“×¢×•×ª ×‘×•×˜ ×§×•×“××•×ª (××©××™×¨ ××ª ×”×™×¡×˜×•×¨×™×™×ª ×”××©×ª××©)
            // ×œ×¦×•×¨×š ×”×¤×©×˜×•×ª × × ×§×” ×”×›×œ
            screen.innerHTML = '';
            
            // ×”×•×“×¢×ª ×‘×•×˜
            const bubble = document.createElement('div');
            bubble.className = 'bubble bubble-bot';
            // ×”××¨×ª ×›×•×›×‘×™×•×ª ×œ×”×“×’×©×”
            bubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            screen.appendChild(bubble);

            // ×›×¤×ª×•×¨×™×
            if(buttons && buttons.length) {
                buttons.forEach(btn => {
                    const b = document.createElement('div');
                    b.className = 'bubble-btn';
                    b.innerText = btn.label;
                    screen.appendChild(b);
                });
            }
        };

        window.testBot = () => {
            const input = document.getElementById('simInput');
            const txt = input.value;
            if(!txt) return;

            // ×”×¦×’ ×”×•×“×¢×ª ××©×ª××©
            const screen = document.getElementById('simScreen');
            screen.innerHTML += `<div class="bubble bubble-user">${txt}</div>`;
            input.value = '';
            screen.scrollTop = screen.scrollHeight;

            // ×‘×“×™×§×” ×”×× ×”××™×œ×” ×§×™×™××ª ×‘××•×— ×”× ×•×›×—×™
            const currentKeywords = document.getElementById('editKeywords').value.split(',').map(s=>s.trim());
            const match = currentKeywords.some(k => txt.includes(k));

            setTimeout(() => {
                if(match) {
                    const ans = document.getElementById('editAnswer').value;
                    const btns = JSON.parse(document.getElementById('editButtons').value || '[]');
                    
                    const botDiv = document.createElement('div');
                    botDiv.className = 'bubble bubble-bot';
                    botDiv.innerHTML = ans.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
                    screen.appendChild(botDiv);
                    
                    btns.forEach(b => {
                        screen.innerHTML += `<div class="bubble-btn">${b.label}</div>`;
                    });
                } else {
                    screen.innerHTML += `<div class="bubble bubble-bot text-red-500">×”×‘×•×˜ ×œ× ×–×™×”×” ××ª ××™×œ×•×ª ×”××¤×ª×— ×©×”×’×“×¨×ª ×‘× ×•×©× ×–×”. × ×¡×” ××™×œ×” ××”×¨×©×™××”.</div>`;
                }
                screen.scrollTop = screen.scrollHeight;
            }, 600);
        };

        // --- ×¤×¢×•×œ×•×ª ×›×œ×œ×™×•×ª ---
        window.createNewTopic = () => {
            const newId = Date.now();
            brainData.push({ id: newId, topic: "× ×•×©× ×—×“×©", keywords: [], answer: "", buttons: [] });
            renderList();
            loadTopic(newId);
        };

        window.saveChanges = () => {
            if(!activeId) return;
            // ×¢×“×›×•×Ÿ ×”××¢×¨×š ×”××§×•××™
            const item = brainData.find(i => i.id === activeId);
            item.topic = document.getElementById('editTopic').value;
            item.keywords = document.getElementById('editKeywords').value.split(',').map(s=>s.trim());
            item.answer = document.getElementById('editAnswer').value;
            try {
                item.buttons = JSON.parse(document.getElementById('editButtons').value);
            } catch(e) { alert("×©×’×™××” ×‘×¤×•×¨××˜ ×”×›×¤×ª×•×¨×™× (JSON)"); return; }

            renderList();
            
            // ×× ×™××¦×™×™×ª ×©××™×¨×”
            const btn = document.querySelector('header button');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> × ×©××¨!';
            btn.classList.add('bg-green-700');
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                btn.classList.remove('bg-green-700');
            }, 1500);
        };

        window.deleteTopic = () => {
            if(!confirm("×œ××—×•×§ × ×•×©× ×–×”?")) return;
            brainData = brainData.filter(i => i.id !== activeId);
            document.getElementById('editorPanel').classList.add('hidden');
            document.getElementById('welcomeMsg').classList.remove('hidden');
            renderList();
        };

    </script>
</body>
</html>
