<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sika Expert Kiosk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --sika-yellow: #ffc500; --sika-red: #e3000f; --sika-black: #111111; }
        body { font-family: 'Rubik', sans-serif; background-color: #f4f4f4; overflow: hidden; user-select: none; }
        
        /* Screens */
        #screen-attract { background: var(--sika-yellow); position: fixed; inset: 0; z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .pulse-btn { animation: pulse 2s infinite; }
        
        /* Buttons */
        .cat-btn { background: white; border-bottom: 6px solid #ddd; transition: all 0.2s; position: relative; overflow: hidden; }
        .cat-btn:active { transform: translateY(4px); border-bottom: 2px solid #ddd; }
        .cat-btn:hover::after { width: 100%; }
        .cat-btn::after { content: ''; position: absolute; bottom: 0; right: 0; width: 0; height: 4px; background: var(--sika-red); transition: width 0.3s; }

        /* Ticket */
        .ticket-modal { background: white; width: 350px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); border-top: 10px solid var(--sika-yellow); transform: translateY(100vh); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .ticket-modal.show { transform: translateY(0); }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Chat */
        .chat-bubbles { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { max-width: 80%; padding: 15px; border-radius: 20px; font-size: 18px; line-height: 1.4; animation: popIn 0.3s; }
        .bubble.bot { background: white; color: black; border-bottom-right-radius: 4px; border: 1px solid #ddd; }
        .bubble.user { background: var(--sika-red); color: white; align-self: flex-end; border-bottom-left-radius: 4px; }
    </style>
</head>
<body>

    <div id="screen-attract" onclick="window.startSession()">
        <div class="bg-black text-white px-8 py-4 text-4xl font-black rotate-[-2deg] mb-6 shadow-xl border-4 border-white">Sika PRO Center</div>
        <h1 class="text-6xl font-black text-black mb-4 uppercase tracking-tighter">מרכז המומחים</h1>
        <p class="text-2xl font-bold text-gray-800 mb-12">ייעוץ טכני • איתור מוצרים • הדפסת הזמנה</p>
        <div class="bg-white text-black px-10 py-6 rounded-full text-2xl font-bold shadow-2xl pulse-btn flex items-center gap-4 border-2 border-black">
            <i class="fas fa-fingerprint text-3xl"></i> גע במסך להתחלה
        </div>
    </div>

    <div id="screen-main" class="hidden h-screen flex flex-col">
        <header class="h-24 bg-[#111] flex justify-between items-center px-8 shadow-lg shrink-0">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-[#ffc500] flex items-center justify-center font-black text-2xl skew-x-[-10deg] border-2 border-white">Sika</div>
                <div class="text-white">
                    <div class="text-2xl font-bold leading-none">היועץ הדיגיטלי</div>
                    <div class="text-sm text-gray-400">מופעל ע"י Saban AI</div>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <button onclick="window.resetKiosk()" class="text-white hover:text-red-500 transition"><i class="fas fa-power-off text-2xl"></i> סיום</button>
                <div class="bg-white text-black px-6 py-3 rounded-xl font-bold flex items-center gap-3 shadow cursor-pointer" onclick="window.showTicket()">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span class="text-xl" id="cartCount">0</span>
                    <span class="text-sm text-gray-500">פריטים</span>
                </div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <div class="w-1/4 bg-gray-100 p-4 flex flex-col gap-3 overflow-y-auto border-l shadow-inner">
                <button onclick="window.setMode('chat')" class="cat-btn p-6 rounded-xl text-right flex items-center gap-4 bg-gradient-to-r from-gray-800 to-gray-900 text-white border-none">
                    <i class="fas fa-robot text-3xl text-[#ffc500]"></i>
                    <div><div class="font-bold text-xl">שאל את המומחה</div><div class="text-xs text-gray-400">ייעוץ חופשי בשפה טבעית</div></div>
                </button>
                <div class="text-sm font-bold text-gray-400 mt-4 mb-2 pr-2">קטגוריות מהירות</div>
                <button onclick="window.showProducts('sealing')" class="cat-btn p-5 rounded-xl text-right flex items-center gap-4">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600"><i class="fas fa-tint"></i></div>
                    <span class="font-bold text-lg text-gray-700">איטום (Waterproof)</span>
                </button>
                <button onclick="window.showProducts('concrete')" class="cat-btn p-5 rounded-xl text-right flex items-center gap-4">
                    <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600"><i class="fas fa-cubes"></i></div>
                    <span class="font-bold text-lg text-gray-700">שיקום בטון</span>
                </button>
                <button onclick="window.showProducts('flooring')" class="cat-btn p-5 rounded-xl text-right flex items-center gap-4">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600"><i class="fas fa-th"></i></div>
                    <span class="font-bold text-lg text-gray-700">ריצוף וחיפוי</span>
                </button>
            </div>

            <div class="flex-1 bg-[#f4f4f4] relative overflow-hidden">
                <div id="view-chat" class="h-full flex flex-col">
                    <div id="chatBox" class="chat-bubbles">
                        <div class="bubble bot flex gap-4 items-start">
                            <div class="w-12 h-12 bg-[#ffc500] rounded-full flex items-center justify-center font-bold shrink-0 border border-black">S</div>
                            <div><b>שלום! אני המומחה של סיקה.</b><br>אני מחובר למאגר הידע העולמי. שאל אותי כל שאלה טכנית.</div>
                        </div>
                    </div>
                    <div class="p-6 bg-white border-t flex gap-4 items-center shadow-lg">
                        <input id="chatInput" class="flex-1 h-16 bg-gray-100 rounded-2xl px-6 text-xl outline-none focus:ring-2 ring-[#ffc500]" placeholder="לדוגמה: איך אוטמים גג מרוצף?" onkeydown="if(event.key==='Enter') window.sendChat()">
                        <button onclick="window.sendChat()" class="w-16 h-16 bg-black text-[#ffc500] rounded-2xl text-2xl hover:scale-105 transition"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>

                <div id="view-grid" class="h-full p-6 overflow-y-auto hidden">
                    <h2 class="text-3xl font-black text-gray-800 mb-6 flex items-center gap-3"><span class="w-2 h-10 bg-[#ffc500] block"></span><span id="categoryTitle">מוצרים</span></h2>
                    <div id="productsGrid" class="grid grid-cols-3 gap-6"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="ticketOverlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center backdrop-blur-sm" onclick="window.closeTicket(event)">
        <div class="ticket-modal flex flex-col items-center text-center" id="ticketModal">
            <div class="w-16 h-16 bg-[#111] text-white flex items-center justify-center font-black text-xl mb-4">Sika</div>
            <h2 class="text-2xl font-bold mb-2">בון ליקוט הזמנה</h2>
            <div class="text-sm text-gray-500 mb-4 border-b w-full pb-2">תאריך: <span id="ticketDate"></span></div>
            <div id="ticketItems" class="w-full text-right mb-6 min-h-[100px] text-lg"></div>
            <div class="border-t-2 border-dashed border-gray-300 w-full pt-4 mb-6">
                <div class="flex justify-between font-bold text-xl"><span>סה"כ פריטים:</span><span id="ticketTotal">0</span></div>
            </div>
            <button onclick="window.printTicket()" class="w-full bg-[#ffc500] hover:bg-[#e6b200] text-black font-bold py-4 rounded-xl text-xl shadow-lg flex items-center justify-center gap-2"><i class="fas fa-print"></i> הדפס לקופה</button>
        </div>
    </div>

    <script type="module">
        // API Key
        const GEMINI_KEY = "AIzaSyD9plWwyTESFm24c_OTunf4mFAsAmfrgj0";

        // Data Base
        const sikaProducts = [
            { id: 101, name: "Sika TopSeal 107", cat: "sealing", price: 120, drying: "4-6 שעות", desc: "איטום צמנטי גמיש למקלחות/מרפסות.", img: "https://via.placeholder.com/200?text=Sika+107" },
            { id: 102, name: "Sika MonoTop 612", cat: "concrete", price: 85, drying: "24 שעות", desc: "מלט לתיקון בטון ושיקום עמודים.", img: "https://via.placeholder.com/200?text=MonoTop+612" },
            { id: 103, name: "Sika Ceram 255", cat: "flooring", price: 60, drying: "3 שעות (דלי)", desc: "דבק קרמיקה גמיש C2TE S1.", img: "https://via.placeholder.com/200?text=Ceram+255" },
            { id: 104, name: "Sikaflex 11FC", cat: "sealing", price: 35, drying: "3 מ\"מ/יום", desc: "מסטיק איטום והדבקה רב תכליתי.", img: "https://via.placeholder.com/200?text=Sikaflex+11FC" },
            { id: 105, name: "Sika Grout 214", cat: "concrete", price: 90, drying: "מהיר", desc: "דייס צמנטי לעיגון מכונות.", img: "https://via.placeholder.com/200?text=Grout+214" }
        ];

        let cart = [];

        // --- Functions exposed to Window ---
        window.startSession = () => {
            document.getElementById('screen-attract').style.display = 'none';
            document.getElementById('screen-main').classList.remove('hidden');
        };

        window.resetKiosk = () => {
            cart = []; window.updateCartBadge();
            document.getElementById('chatBox').innerHTML = '<div class="bubble bot"><b>שלום!</b> שאל אותי כל דבר.</div>';
            document.getElementById('screen-main').classList.add('hidden');
            document.getElementById('screen-attract').style.display = 'flex';
        };

        window.setMode = (mode) => {
            document.getElementById('view-chat').classList.add('hidden');
            document.getElementById('view-grid').classList.add('hidden');
            document.getElementById(mode === 'chat' ? 'view-chat' : 'view-grid').classList.remove('hidden');
        };

        window.showProducts = (cat) => {
            window.setMode('grid');
            const map = { 'sealing': 'פתרונות איטום', 'concrete': 'שיקום בטון', 'flooring': 'דבקים ורובה' };
            document.getElementById('categoryTitle').innerText = map[cat];
            const items = sikaProducts.filter(p => p.cat === cat);
            document.getElementById('productsGrid').innerHTML = items.map(p => `
                <div class="bg-white border rounded-xl overflow-hidden shadow-sm flex flex-col">
                    <div class="h-40 bg-white flex items-center justify-center border-b p-4"><img src="${p.img}" class="h-full object-contain"></div>
                    <div class="p-4 flex-1 flex flex-col">
                        <h3 class="font-bold text-lg mb-1">${p.name}</h3>
                        <p class="text-sm text-gray-500 mb-3">${p.desc}</p>
                        <div class="mt-auto flex justify-between items-center">
                            <span class="text-xl font-black">₪${p.price}</span>
                            <button onclick="window.addToCart(${p.id})" class="bg-[#e3000f] text-white px-4 py-2 rounded-lg font-bold">הוסף</button>
                        </div>
                    </div>
                </div>`).join('');
        };

        window.addToCart = (id) => {
            const p = sikaProducts.find(x => x.id === id);
            cart.push(p);
            window.updateCartBadge();
        };

        window.updateCartBadge = () => document.getElementById('cartCount').innerText = cart.length;

        // --- REAL AI LOGIC ---
        window.sendChat = async () => {
            const inp = document.getElementById('chatInput');
            const txt = inp.value; if(!txt) return;
            
            // UI Update
            addBubble(txt, 'user');
            inp.value = '';
            const loadId = addBubble('<i class="fas fa-circle-notch fa-spin"></i> חושב...', 'bot');

            // Inventory Context for AI
            const context = sikaProducts.map(p => `${p.name} (${p.desc})`).join(", ");

            // API Call
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`;
                const prompt = `
                אתה המומחה של חברת Sika בחנות חומרי בניין.
                שאלה של לקוח: "${txt}"
                רשימת מוצרים זמינה בחנות: ${context}
                הנחיות: ענה בעברית, קצר ומקצועי. המלץ רק על מוצרים מהרשימה אם רלוונטי.
                `;

                const res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await res.json();
                const ans = data.candidates?.[0]?.content?.parts?.[0]?.text || "לא הצלחתי להתחבר לשרת.";
                
                document.getElementById(loadId).remove();
                addBubble(ans, 'bot');

                // Auto-suggest product card if AI mentions one
                const mentioned = sikaProducts.find(p => ans.includes(p.name));
                if(mentioned) addProductCard(mentioned);

            } catch(e) {
                document.getElementById(loadId).remove();
                addBubble("תקלת תקשורת. אנא פנה לדלפק.", 'bot');
            }
        };

        function addBubble(html, type) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `bubble ${type}`;
            div.id = 'msg-' + Date.now();
            div.innerHTML = html.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
            return div.id;
        }

        function addProductCard(p) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.innerHTML = `
                <div class="bg-white p-3 rounded-xl border shadow-md max-w-sm self-start mb-4 flex gap-3">
                    <img src="${p.img}" class="w-16 h-16 object-contain border rounded">
                    <div>
                        <div class="font-bold">${p.name}</div>
                        <button onclick="window.addToCart(${p.id})" class="bg-[#e3000f] text-white px-3 py-1 rounded text-sm font-bold mt-1">הוסף לעגלה ₪${p.price}</button>
                    </div>
                </div>`;
            box.appendChild(div.firstElementChild);
            box.scrollTop = box.scrollHeight;
        }

        // --- Ticket ---
        window.showTicket = () => {
            if(!cart.length) return alert("עגלה ריקה");
            const list = document.getElementById('ticketItems');
            list.innerHTML = cart.map(p => `<div class="flex justify-between border-b border-dashed py-1"><span>${p.name}</span><span>1</span></div>`).join('');
            document.getElementById('ticketDate').innerText = new Date().toLocaleString();
            document.getElementById('ticketTotal').innerText = cart.length;
            document.getElementById('ticketOverlay').classList.remove('hidden');
            setTimeout(() => document.getElementById('ticketModal').classList.add('show'), 10);
        };

        window.closeTicket = (e) => {
            if(e.target.id === 'ticketOverlay') {
                document.getElementById('ticketModal').classList.remove('show');
                setTimeout(() => document.getElementById('ticketOverlay').classList.add('hidden'), 300);
            }
        };

        window.printTicket = () => {
            const btn = document.querySelector('#ticketModal button');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> מדפיס...';
            setTimeout(() => {
                alert("הודפס בהצלחה! גש לקופה.");
                window.resetKiosk();
                document.getElementById('ticketModal').classList.remove('show');
                document.getElementById('ticketOverlay').classList.add('hidden');
                btn.innerHTML = '<i class="fas fa-print"></i> הדפס לקופה';
            }, 1000);
        };
    </script>
</body>
</html>
