<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SabanOS | ××¡×•×£ ×œ×™×§×•×˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-800 text-white p-4 font-sans">
    
    <header class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
        <h1 class="text-2xl font-bold text-yellow-400"><i class="fas fa-dolly"></i> ××©×™××•×ª ×œ×™×§×•×˜</h1>
        <div class="text-sm text-gray-400">××—×•×‘×¨: <span id="pickerName">××•×¨×Ÿ</span></div>
    </header>

    <div id="pickingTasks" class="space-y-4"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ×××–×™×Ÿ ×œ×”×–×× ×•×ª ×‘×¡×˜×˜×•×¡ "picking" (×‘×œ×™×§×•×˜)
        const q = query(collection(db, "orders"), where("status", "==", "picking"));
        
        onSnapshot(q, (snap) => {
            const container = document.getElementById('pickingTasks');
            container.innerHTML = '';
            
            if(snap.empty) {
                container.innerHTML = "<div class='text-gray-500 text-center mt-20 text-lg'>×”×›×œ × ×§×™. ××™×Ÿ ××©×™××•×ª. ğŸ‘</div>";
                return;
            }

            snap.forEach(d => {
                const o = d.data();
                container.innerHTML += `
                <div class="bg-gray-700 p-5 rounded-xl border border-gray-600 shadow-xl">
                    <div class="flex justify-between mb-4">
                        <h2 class="text-xl font-bold text-white">${o.clientName}</h2>
                        <span class="bg-blue-600 px-3 py-1 rounded-full text-xs font-bold">${o.project || '×›×œ×œ×™'}</span>
                    </div>
                    
                    <div class="bg-gray-800 p-4 rounded-lg mb-4">
                        <ul class="space-y-2 text-lg">
                            ${o.items ? o.items.map(i => `<li class="flex justify-between border-b border-gray-700 pb-1">
                                <span>â¬œ ${i.name}</span>
                                <b class="text-yellow-400">x${i.qty}</b>
                            </li>`).join('') : '×©×’×™××” ×‘×¤×¨×™×˜×™×'}
                        </ul>
                    </div>

                    <button onclick="window.finishPick('${d.id}')" class="w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex justify-center items-center gap-2">
                        <i class="fas fa-box-check"></i> ×¡×™×•× ×œ×™×§×•×˜ ×•×”×¢×‘×¨×” ×œ× ×”×’
                    </button>
                </div>`;
            });
        });

        window.finishPick = async (id) => {
            // ××¢×‘×™×¨ ×œ×¡×˜×˜×•×¡ 'shipping' (××• 'loaded') ×›×“×™ ×©×™×•×¤×™×¢ ××¦×œ ×”× ×”×’
            await updateDoc(doc(db, "orders", id), { status: "shipping" });
        };
    </script>
</body>
</html>
