<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title> 爪转 住</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; padding: 20px; }
        .user-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; transition: 0.2s; }
        .user-card:hover { border-color: #3b82f6; }
    </style>
</head>
<body>

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-black mb-8 text-blue-500 flex items-center gap-3">
            <i class="fas fa-users-cog"></i>  爪转 专砖转
        </h1>

        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl mb-8">
            <h2 class="text-lg font-bold mb-4 text-gray-300">住 砖 爪转 砖</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                
                <div>
                    <label class="text-xs text-gray-500 block mb-1">砖 </label>
                    <input id="u-name" placeholder="砖: 注 " class="w-full bg-slate-900 border border-slate-600 p-3 rounded text-white outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="text-xs text-gray-500 block mb-1">驻 ( 拽祝)</label>
                    <input id="u-phone" type="tel" placeholder="0501234567" class="w-full bg-slate-900 border border-slate-600 p-3 rounded text-white outline-none focus:border-blue-500 font-mono">
                </div>
                
                <div>
                    <label class="text-xs text-gray-500 block mb-1">转驻拽</label>
                    <select id="u-role" class="w-full bg-slate-900 border border-slate-600 p-3 rounded text-white outline-none">
                        <option value="driver">  (爪注)</option>
                        <option value="warehouse"> 住</option>
                        <option value="admin">  / "</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs text-gray-500 block mb-1">转 (驻爪)</label>
                    <input id="u-img" placeholder="拽 转" class="w-full bg-slate-900 border border-slate-600 p-3 rounded text-white outline-none text-xs">
                </div>
            </div>
            
            <button onclick="addUser()" class="mt-6 w-full py-3 bg-gradient-to-r from-green-600 to-green-700 rounded-xl font-bold shadow-lg hover:from-green-500 hover:to-green-600 flex items-center justify-center gap-2 transition">
                <i class="fab fa-whatsapp text-xl"></i> 爪专 砖转砖 砖 拽 转拽
            </button>
        </div>

        <h3 class="font-bold text-gray-400 mb-4 border-b border-gray-700 pb-2">爪转 驻注 注专转</h3>
        <div id="team-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));

        window.addUser = async () => {
            const name = document.getElementById('u-name').value;
            const phone = document.getElementById('u-phone').value;
            const role = document.getElementById('u-role').value;
            let img = document.getElementById('u-img').value;

            if(!name || !phone) return Swal.fire('砖', '  砖 驻', 'error');
            if(!img) img = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=random&color=fff`;

            // 1. 砖专 -DB
            const docRef = await addDoc(collection(db, "users"), {
                name, phone, role, photo: img, 
                status: 'offline', createdAt: serverTimestamp()
            });

            // 2. 爪专转 拽 
            // 拽  驻 -index.html 注 驻专专 砖 转 砖转砖
            const baseUrl = "https://saban-system.onrender.com/index.html"; 
            const magicLink = `${baseUrl}?user_id=${docRef.id}`;
            
            // 3. 驻转转 住驻
            const msg = ` ${name}, 专  爪转 住! \n\n 转 注 拽 住专 注, 抓 注 拽 转拽 转 驻拽爪:\n${magicLink}`;
            
            // 专转 驻 驻专 
            let cleanPhone = phone.replace('-', '').replace(' ', '');
            if(cleanPhone.startsWith('0')) cleanPhone = '972' + cleanPhone.substring(1);

            window.open(`https://wa.me/${cleanPhone}?text=${encodeURIComponent(msg)}`, '_blank');
            
            // 拽 驻住
            document.getElementById('u-name').value = '';
            document.getElementById('u-phone').value = '';
        };

        //  砖 爪转
        onSnapshot(collection(db, "users"), (snap) => {
            const list = document.getElementById('team-list');
            list.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                const roleIcon = u.role === 'driver' ? '' : (u.role === 'admin' ? '' : '');
                
                list.innerHTML += `
                <div class="user-card group">
                    <img src="${u.photo}" class="w-12 h-12 rounded-full border-2 border-gray-500">
                    <div class="flex-1">
                        <div class="font-bold text-lg">${u.name}</div>
                        <div class="text-xs text-gray-400">${roleIcon} ${u.role} | ${u.phone}</div>
                    </div>
                    <button onclick="deleteUser('${d.id}')" class="bg-slate-800 hover:bg-red-600 p-2 rounded text-gray-400 hover:text-white transition">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>`;
            });
        });

        window.deleteUser = async (id) => {
            if(confirm('拽 砖 爪转 ?')) await deleteDoc(doc(db, "users", id));
        }
    </script>
</body>
</html>
