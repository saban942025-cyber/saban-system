<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SabanOS | מערכת ראשית</title>
    <link rel="icon" href="https://saban-system.onrender.com/icons/icon-192.png">
    <link rel="manifest" href="manifest-chat.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* הגדרות בסיס */
        body { 
            margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f1f5f9; 
            height: 100vh; width: 100vw;
            display: flex; 
            flex-direction: row; /* במחשב: שורה (סרגל בצד) */
            overflow: hidden; 
        }

        /* --- 1. סרגל צד (דסקטופ בלבד) --- */
        .desktop-sidebar {
            width: 80px; 
            background: #1e293b; /* הכחול הכהה מהתמונה שלך */
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 50;
        }
        
        .sidebar-btn {
            width: 50px; height: 50px; border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #94a3b8; cursor: pointer; transition: 0.2s; position: relative;
        }
        .sidebar-btn i { font-size: 20px; margin-bottom: 2px; }
        .sidebar-btn span { font-size: 9px; font-weight: bold; }
        
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-btn.active { background: #3b82f6; color: white; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4); }

        .logo-icon { width: 45px; height: 45px; border-radius: 10px; margin-bottom: 20px; border: 2px solid rgba(255,255,255,0.2); }

        /* --- 2. אזור תוכן ראשי (הבמה) --- */
        .main-stage {
            flex: 1; position: relative; background: #f8fafc; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- 3. סרגל תחתון (מובייל בלבד) --- */
        .mobile-nav {
            display: none; /* מוסתר במחשב */
            height: 65px; background: white; border-top: 1px solid #e2e8f0;
            justify-content: space-around; align-items: center;
            padding-bottom: env(safe-area-inset-bottom); z-index: 50;
        }
        
        .mobile-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #94a3b8; width: 60px; height: 100%;
        }
        .mobile-btn i { font-size: 20px; margin-bottom: 4px; }
        .mobile-btn.active { color: #2563eb; }

        /* --- שינויים למובייל (Media Query) --- */
        @media (max-width: 768px) {
            body { flex-direction: column; } /* במובייל: עמודה (תוכן למעלה, סרגל למטה) */
            .desktop-sidebar { display: none; } /* הסתרת סרגל צד */
            .mobile-nav { display: flex; } /* הצגת סרגל תחתון */
        }

        /* --- Views (פורטל ואפליקציות) --- */
        .view-container { position: absolute; inset: 0; overflow: hidden; }
        
        /* דף הבית (פורטל) */
        #portal-view { 
            z-index: 10; overflow-y: auto; padding: 20px; 
            display: flex; flex-direction: column; gap: 20px;
            background: #f1f5f9;
        }

        /* מסגרת האפליקציות (Iframe) */
        #app-view { 
            z-index: 20; background: white; transform: translateX(100%); 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #app-view.active { transform: translateX(0); }
        iframe { width: 100%; height: 100%; border: none; }

        /* עיצוב כרטיסי פורטל */
        .portal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .apps-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .app-card {
            background: white; padding: 20px; border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); border: 1px solid #e2e8f0; cursor: pointer;
        }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
    </style>
</head>
<body>

    <nav class="desktop-sidebar">
        <img src="https://saban-system.onrender.com/icons/icon-192.png" class="logo-icon">
        
        <div class="sidebar-btn active" onclick="goHome()" id="desk-home">
            <i class="fas fa-home"></i><span>בית</span>
        </div>
        <div class="sidebar-btn" onclick="openApp('chat')" id="desk-chat">
            <i class="fab fa-whatsapp"></i><span>צ'אט</span>
        </div>
        <div class="sidebar-btn" onclick="openApp('drive')" id="desk-drive">
            <i class="fas fa-folder"></i><span>דרייב</span>
        </div>
        <div class="sidebar-btn" onclick="openApp('staff')" id="desk-staff">
            <i class="fas fa-users"></i><span>צוות</span>
        </div>
        <div class="sidebar-btn" onclick="openApp('truck')" id="desk-truck">
            <i class="fas fa-truck"></i><span>נהג</span>
        </div>
    </nav>

    <main class="main-stage">
        
        <div id="portal-view" class="view-container">
            <div class="portal-header">
                <div>
                    <h1 class="text-xl font-bold text-slate-800">SabanOS</h1>
                    <p class="text-xs text-slate-500">פורטל ארגוני</p>
                </div>
                <img src="https://ui-avatars.com/api/?name=Admin" class="w-8 h-8 rounded-full">
            </div>

            <div class="apps-grid">
                <div class="app-card" onclick="openApp('chat')">
                    <div class="icon-box bg-green-500"><i class="fab fa-whatsapp"></i></div>
                    <div class="font-bold text-sm text-slate-700">תקשורת</div>
                </div>
                <div class="app-card" onclick="openApp('drive')">
                    <div class="icon-box bg-blue-500"><i class="fas fa-cloud"></i></div>
                    <div class="font-bold text-sm text-slate-700">מסמכים</div>
                </div>
                <div class="app-card" onclick="openApp('staff')">
                    <div class="icon-box bg-purple-500"><i class="fas fa-users-cog"></i></div>
                    <div class="font-bold text-sm text-slate-700">ניהול צוות</div>
                </div>
                <div class="app-card" onclick="openApp('truck')">
                    <div class="icon-box bg-slate-700"><i class="fas fa-truck-loading"></i></div>
                    <div class="font-bold text-sm text-slate-700">מסוף נהג</div>
                </div>
            </div>

            <div class="mt-6">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">אנשי קשר</h3>
                <div id="quick-contacts" class="flex flex-col gap-2">
                    </div>
            </div>
        </div>

        <div id="app-view" class="view-container">
            <iframe id="main-frame" src=""></iframe>
        </div>

    </main>

    <nav class="mobile-nav">
        <div class="mobile-btn active" onclick="goHome()" id="mob-home">
            <i class="fas fa-home"></i>
        </div>
        <div class="mobile-btn" onclick="openApp('chat')" id="mob-chat">
            <i class="fab fa-whatsapp"></i>
        </div>
        <div class="mobile-btn" onclick="openApp('drive')" id="mob-drive">
            <i class="fas fa-folder-open"></i>
        </div>
        <div class="mobile-btn" onclick="openApp('staff')" id="mob-staff">
            <i class="fas fa-users"></i>
        </div>
        <div class="mobile-btn" onclick="openApp('truck')" id="mob-truck">
            <i class="fas fa-truck"></i>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));

        // --- NAVIGATION ENGINE ---
        
        window.goHome = () => {
            // הסתרת האפליקציה וחזרה לפורטל
            document.getElementById('app-view').classList.remove('active');
            updateButtons('home');
            
            // ניקוי ה-iframe כדי לא להכביד (אופציונלי, אפשר להשאיר לרענון מהיר)
            // setTimeout(() => document.getElementById('main-frame').src = '', 300);
        };

        window.openApp = (appId) => {
            let url = '';
            // מיפוי קבצים מדויק
            switch(appId) {
                case 'chat': url = 'comm-center.html'; break;
                case 'drive': url = 'documents-drive.html'; break;
                case 'staff': url = 'staff-directory-view.html'; break; // או yoav-app.html תלוי בך
                case 'truck': url = 'driver-app.html'; break;
            }

            const frame = document.getElementById('main-frame');
            if(!frame.src.includes(url)) frame.src = url;

            document.getElementById('app-view').classList.add('active');
            updateButtons(appId);
        };

        function updateButtons(activeId) {
            // ניקוי כל הכפתורים
            document.querySelectorAll('.sidebar-btn, .mobile-btn').forEach(b => b.classList.remove('active'));
            
            // הפעלת הכפתור הרלוונטי (גם בדסקטופ וגם במובייל)
            const dBtn = document.getElementById(`desk-${activeId}`);
            const mBtn = document.getElementById(`mob-${activeId}`);
            
            if(dBtn) dBtn.classList.add('active');
            if(mBtn) mBtn.classList.add('active');
        }

        // --- QUICK CONTACTS LOADER ---
        onSnapshot(query(collection(db, "users"), orderBy("name")), (snap) => {
            const list = document.getElementById('quick-contacts');
            list.innerHTML = '';
            
            snap.docs.slice(0, 5).forEach(d => {
                const u = d.data();
                if(u.type === 'client') return;
                
                list.innerHTML += `
                <div class="bg-white p-3 rounded-xl border border-slate-200 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img src="${u.avatar || `https://ui-avatars.com/api/?name=${u.name}`}" class="w-8 h-8 rounded-full">
                        <div class="text-sm font-bold text-slate-700">${u.name}</div>
                    </div>
                    <a href="https://wa.me/972${u.phone?.replace(/^0/,'')}" target="_blank" class="text-green-500"><i class="fab fa-whatsapp text-lg"></i></a>
                </div>`;
            });
        });

    </script>
</body>
</html>
