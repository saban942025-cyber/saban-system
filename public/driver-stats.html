<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saban Driver Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { background: #f1f5f9; font-family: -apple-system, sans-serif; padding-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        .history-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #e2e8f0; }
    </style>
</head>
<body>

    <div class="bg-slate-800 text-white p-6 rounded-b-3xl shadow-lg mb-6">
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-2xl border-2 border-white">ğŸ‘¨â€âœˆï¸</div>
                <div>
                    <h1 class="text-xl font-bold" id="driver-title">×©×œ×•× ×¢×œ×™</h1>
                    <div class="text-xs opacity-70">××–×•×¨ ××™×©×™</div>
                </div>
            </div>
            <button onclick="window.history.back()" class="bg-white/20 p-2 rounded-full"><i class="fas fa-arrow-left"></i></button>
        </div>
        
        <div class="bg-green-600/20 border border-green-500/30 p-3 rounded-xl text-center">
            <span id="praise-msg">×˜×•×¢×Ÿ × ×ª×•× ×™×...</span>
        </div>
    </div>

    <div class="px-5">
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="stat-card">
                <div class="text-3xl font-black text-blue-600 mb-1" id="count-val">0</div>
                <div class="text-xs text-gray-500 font-bold uppercase">××©×™××•×ª ×”×—×•×“×©</div>
            </div>
            <div class="stat-card">
                <div class="text-3xl font-black text-green-600 mb-1" id="km-val">0</div>
                <div class="text-xs text-gray-500 font-bold uppercase">×§×™×œ×•××˜×¨×™×</div>
            </div>
        </div>

        <h3 class="font-bold text-slate-700 mb-3 px-1">×”×™×¡×˜×•×¨×™×™×ª ×‘×™×¦×•×¢×™×</h3>
        <div id="history-list">
            <div class="text-center py-10 text-gray-400"><i class="fas fa-circle-notch fa-spin"></i></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));
        
        // ×–×™×”×•×™ × ×”×’
        const driverName = localStorage.getItem('saban_driver') || '×¢×œ×™';
        document.getElementById('driver-title').innerText = driverName;

        window.onload = async () => {
            // ×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”
            // × ×—×¤×© ×‘-orders ××™×¤×” ×©×”×¡×˜×˜×•×¡ ×”×•× done
            const q = query(collection(db, "orders"), where("driver", "==", driverName), where("status", "==", "done"), orderBy("lastUpdate", "desc"), limit(20));
            const snap = await getDocs(q);
            
            const list = document.getElementById('history-list');
            list.innerHTML = "";
            
            let totalCount = snap.size;
            
            // ×”×•×“×¢×ª ×¤×¨×’×•×Ÿ
            const praise = totalCount > 5 ? "ğŸ”¥ ×¢×œ×™ ××ª×” ××©! ×©×‘×¨×ª ×©×™×!" : (totalCount > 0 ? "×¢×‘×•×“×” ×™×¤×” ×¢×œ×™, ×ª××©×™×š ×›×›×”! ğŸ‘" : "×”×™×™ ×¢×œ×™, ××—×›×™× ×œ××©×™××” ×”×¨××©×•× ×” ×©×œ×š!");
            document.getElementById('praise-msg').innerText = praise;
            document.getElementById('count-val').innerText = totalCount;
            document.getElementById('km-val').innerText = (totalCount * 12.5).toFixed(0); // ×¡×™××•×œ×¦×™×” ×œ×§"×

            snap.forEach(d => {
                const task = d.data();
                const date = task.lastUpdate ? new Date(task.lastUpdate.seconds*1000).toLocaleDateString() : '';
                
                list.innerHTML += `
                <div class="history-item">
                    <div>
                        <div class="font-bold text-slate-800">${task.clientName}</div>
                        <div class="text-xs text-gray-500">${date} â€¢ ${task.address || '×œ×œ× ×›×ª×•×‘×ª'}</div>
                    </div>
                    <div class="flex gap-2">
                        <a href="waze://?q=${encodeURIComponent(task.address)}&navigate=yes" class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-blue-200">
                            <i class="fab fa-waze"></i>
                        </a>
                        ${task.clientPhone ? `<a href="tel:${task.clientPhone}" class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-green-200"><i class="fas fa-phone"></i></a>` : ''}
                    </div>
                </div>`;
            });
        };
    </script>
</body>
</html>
