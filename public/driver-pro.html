// הוסף את זה בתוך הסקריפט של driver-pro.html

// פונקציה שמדווחת על סיום נסיעה ושומרת היסטוריה
async function completeDelivery(orderId, clientName) {
    // 1. חישוב זמנים
    const endTime = new Date();
    // (בהנחה ששמרנו את startTime כשיצאנו לדרך)
    const durationMinutes = Math.floor((endTime - currentOrder.startTime) / 60000); 
    
    // 2. שמירה ב"קופסה השחורה" (Driver History DB)
    await addDoc(collection(db, "trip_logs"), {
        driverName: "חכמת", // או דינמי
        clientName: clientName,
        date: endTime.toLocaleDateString('he-IL'),
        startTime: currentOrder.startTime.toLocaleTimeString('he-IL'),
        endTime: endTime.toLocaleTimeString('he-IL'),
        duration: durationMinutes,
        orderId: orderId,
        timestamp: serverTimestamp()
    });

    // 3. עדכון סטטוס רגיל
    await updateDoc(doc(db, "orders", orderId), { status: 'done' });
    
    alert(`נסיעה תועדה! לקח לך ${durationMinutes} דקות.`);
}
