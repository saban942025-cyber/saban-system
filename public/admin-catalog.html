<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saban Admin | ×§×˜×œ×•×’ ×’××•× ×™</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¦</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #f8fafc; font-family: 'Heebo', sans-serif; }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 260px; background: #1e293b; color: white; height: 100vh;
            position: fixed; right: 0; top: 0; display: flex; flex-direction: column;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1); z-index: 50;
        }
        .nav-item {
            padding: 16px 24px; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; gap: 12px; font-weight: 500; border-left: 4px solid transparent;
        }
        .nav-item:hover { background: #334155; }
        .nav-item.active { background: #0f172a; border-left-color: #3b82f6; color: #60a5fa; }

        /* Main Area */
        .main-content { margin-right: 260px; padding: 40px; }
        
        /* Magic Search Bar */
        .magic-search {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            border-radius: 16px; padding: 30px; color: white; margin-bottom: 40px;
            box-shadow: 0 10px 30px -10px rgba(37, 99, 235, 0.5); position: relative; overflow: hidden;
        }
        .magic-search::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: rotate 20s linear infinite; pointer-events: none;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Product Cards */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card {
            background: white; border-radius: 16px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; border: 1px solid #f1f5f9;
            display: flex; flex-direction: column;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); border-color: #bfdbfe; }
        
        /* AI Result Card */
        .ai-card {
            background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .ai-card:hover { border-color: #3b82f6; background: #eff6ff; }
        .ai-badge { position: absolute; top: 10px; left: 10px; background: #3b82f6; color: white; font-size: 10px; padding: 2px 6px; border-radius: 6px; }

        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; border-radius: 24px; animation: popIn 0.3s; padding: 0; }
        
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="p-6 mb-4">
            <div class="text-3xl font-black tracking-tight">Saban<span class="text-blue-400">.AI</span></div>
            <div class="text-xs text-slate-400 mt-1 uppercase tracking-widest">Enterprise Catalog</div>
        </div>
        <div class="nav-item active"><i class="fas fa-box-open w-6"></i> × ×™×”×•×œ ××•×¦×¨×™×</div>
        <div class="nav-item"><i class="fas fa-magic w-6"></i> ×™×•×¢×¥ ×—×›×</div>
        <div class="nav-item"><i class="fas fa-chart-pie w-6"></i> ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
        <div class="mt-auto nav-item text-red-400 hover:bg-red-900/20"><i class="fas fa-sign-out-alt w-6"></i> ×”×ª× ×ª×§</div>
    </div>

    <div class="main-content">
        
        <div class="magic-search">
            <div class="relative z-10">
                <h1 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-robot"></i> ×”×•×¡×¤×ª ××•×¦×¨ ×—×›××”
                </h1>
                <div class="flex gap-2">
                    <div class="flex-1 bg-white/20 backdrop-blur-md rounded-xl p-1 flex items-center border border-white/30 focus-within:border-white/60 transition">
                        <i class="fas fa-search text-white/70 mr-4"></i>
                        <input id="aiSearchInput" type="text" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ (×œ××©×œ: '×“×‘×§ ×§×¨××™×§×”' ××• '××§×“×—×” × ×˜×¢× ×ª')..." 
                               class="bg-transparent border-none outline-none text-white placeholder-white/60 w-full p-2 font-bold"
                               onkeydown="if(event.key==='Enter') window.searchWeb()">
                    </div>
                    <button onclick="window.searchWeb()" class="bg-white text-blue-600 px-6 py-3 rounded-xl font-bold hover:bg-blue-50 transition shadow-lg">
                        <i class="fas fa-bolt"></i> ××¦× ×‘×¨×©×ª
                    </button>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-slate-800">×”××“×£ ×”×“×™×’×™×˜×œ×™ (<span id="count">0</span>)</h2>
            <div class="flex gap-2">
                <input oninput="window.filterLocal()" id="localSearch" class="bg-white border rounded-lg px-4 py-2 text-sm outline-none w-64" placeholder="×¡×™× ×•×Ÿ ××”×™×¨...">
                <button onclick="window.openModal()" class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-700">
                    <i class="fas fa-plus"></i> ×”×•×¡×¤×” ×™×“× ×™×ª
                </button>
            </div>
        </div>

        <div id="productsGrid" class="product-grid">
            <div class="col-span-full text-center py-20 text-gray-400">
                <i class="fas fa-circle-notch fa-spin text-3xl"></i><br>×˜×•×¢×Ÿ ××ª ×”×××’×¨...
            </div>
        </div>
    </div>

    <div id="aiModal" class="modal-overlay">
        <div class="modal-box max-w-4xl bg-slate-50">
            <div class="p-6 border-b bg-white flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h3 class="text-xl font-black text-slate-800">×ª×•×¦××•×ª ×”×—×™×¤×•×© ×”×—×›×</h3>
                    <p class="text-sm text-gray-500">×”-AI ××™×ª×¨ ××ª ×”××•×¦×¨×™× ×”×‘××™×. ×‘×—×¨ ××—×“ ×œ×™×™×‘×•×.</p>
                </div>
                <button onclick="document.getElementById('aiModal').style.display='none'" class="w-8 h-8 bg-gray-100 rounded-full"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="aiResults" class="p-6 grid grid-cols-2 gap-4">
                </div>
        </div>
    </div>

    <div id="editModal" class="modal-overlay">
        <div class="modal-box">
            <div class="flex h-full">
                <div class="w-1/3 bg-slate-50 p-8 border-l flex flex-col items-center text-center">
                    <div class="w-full aspect-square bg-white rounded-2xl shadow-sm border mb-4 flex items-center justify-center overflow-hidden p-4">
                        <img id="prevImg" src="" class="w-full h-full object-contain">
                    </div>
                    <h3 id="prevName" class="font-black text-lg text-slate-800 leading-tight">×©× ×”××•×¦×¨</h3>
                    <div id="prevSku" class="text-xs font-mono text-gray-400 mb-4">SKU</div>
                    <div class="text-3xl font-black text-blue-600 mb-6">â‚ª<span id="prevPrice">0</span></div>
                    
                    <div class="w-full bg-white p-4 rounded-xl border text-right text-xs space-y-2">
                        <div class="flex justify-between"><span class="text-gray-400">××©×§×œ</span><span id="prevWeight">-</span></div>
                        <div class="flex justify-between"><span class="text-gray-400">×›×™×¡×•×™</span><span id="prevCover">-</span></div>
                        <div class="flex justify-between"><span class="text-gray-400">×™×™×‘×•×©</span><span id="prevDry">-</span></div>
                    </div>
                </div>

                <div class="w-2/3 p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-black" id="modalTitle">×¢×¨×™×›×ª ××•×¦×¨</h2>
                        <button onclick="window.closeEdit()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
                    </div>

                    <form id="productForm" onsubmit="event.preventDefault(); window.saveProduct();" class="space-y-4">
                        <input type="hidden" id="editId">
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">×©× ×”××•×¦×¨</label><input id="pName" class="w-full border p-2 rounded font-bold" oninput="window.syncPreview()"></div>
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">××§"×˜</label><input id="pSku" class="w-full border p-2 rounded uppercase font-mono" oninput="window.syncPreview()"></div>
                        </div>

                        <div class="grid grid-cols-3 gap-4">
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">××—×™×¨</label><input id="pPrice" type="number" class="w-full border p-2 rounded font-bold" oninput="window.syncPreview()"></div>
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">××œ××™</label><input id="pStock" type="number" class="w-full border p-2 rounded"></div>
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">×§×˜×’×•×¨×™×”</label>
                                <select id="pCat" class="w-full border p-2 rounded bg-white">
                                    <option value="cement">××œ×˜ ×•×˜×™×—</option>
                                    <option value="glue">×“×‘×§×™×</option>
                                    <option value="paint">×¦×‘×¢</option>
                                    <option value="tools">×›×œ×™ ×¢×‘×•×“×”</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-1">×ª×™××•×¨ ×©×™×•×•×§×™ (×¢×©×™×¨)</label>
                            <textarea id="pDesc" class="w-full border p-2 rounded h-20 text-sm resize-none"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                            <div class="text-xs font-bold text-blue-800 uppercase mb-2">××¤×¨×˜ ×˜×›× ×™ ×œ×§×‘×œ×Ÿ</div>
                            <div class="grid grid-cols-3 gap-3">
                                <div><input id="sWeight" placeholder="××©×§×œ (25 ×§×’)" class="w-full border p-2 rounded text-xs" oninput="window.syncPreview()"></div>
                                <div><input id="sCover" placeholder="×›×™×¡×•×™ (10 ××™×¨)" class="w-full border p-2 rounded text-xs" oninput="window.syncPreview()"></div>
                                <div><input id="sDry" placeholder="×–××Ÿ ×™×™×‘×•×©" class="w-full border p-2 rounded text-xs" oninput="window.syncPreview()"></div>
                            </div>
                        </div>

                        <div class="hidden"><input id="pImg"></div> <div class="pt-4 flex justify-end gap-3">
                            <button type="button" onclick="window.closeEdit()" class="px-6 py-2 rounded-lg font-bold text-gray-500 hover:bg-gray-100">×‘×™×˜×•×œ</button>
                            <button type="submit" class="px-8 py-2 rounded-lg font-bold bg-slate-900 text-white hover:bg-black shadow-lg transform hover:scale-105 transition">×©××•×¨ ×‘××¢×¨×›×ª</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allProducts = [];

        // --- 1. LOAD DATA ---
        onSnapshot(collection(db, "products"), (snap) => {
            allProducts = snap.docs.map(d => ({id: d.id, ...d.data()}));
            document.getElementById('count').innerText = allProducts.length;
            renderGrid(allProducts);
        });

        function renderGrid(data) {
            const grid = document.getElementById('productsGrid');
            if (data.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center text-gray-400 py-10">××™×Ÿ ××•×¦×¨×™×. × ×¡×” ×œ×—×¤×© ×¢× ×”-AI ×œ××¢×œ×”!</div>';
                return;
            }
            grid.innerHTML = data.map(p => `
                <div class="product-card group">
                    <div class="relative h-40 bg-gray-100 flex items-center justify-center overflow-hidden">
                        <img src="${p.img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                        <div class="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-[10px] font-bold shadow">${p.sku}</div>
                    </div>
                    <div class="p-4 flex-1 flex flex-col">
                        <h3 class="font-bold text-slate-800 leading-tight mb-1">${p.name}</h3>
                        <p class="text-xs text-gray-500 line-clamp-2 mb-3">${p.desc || ''}</p>
                        
                        <div class="mt-auto flex justify-between items-center">
                            <span class="font-black text-xl text-blue-600">â‚ª${p.price}</span>
                            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                <button onclick="window.editItem('${p.id}')" class="text-blue-500 hover:bg-blue-50 p-2 rounded"><i class="fas fa-pen"></i></button>
                                <button onclick="window.deleteItem('${p.id}')" class="text-red-500 hover:bg-red-50 p-2 rounded"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- 2. AI WEB SEARCH SIMULATOR ---
        window.searchWeb = () => {
            const query = document.getElementById('aiSearchInput').value;
            if(!query) return alert("×× × ×”×–×Ÿ ××™×œ×ª ×—×™×¤×•×©");

            const mockResults = generateMockData(query);
            
            const container = document.getElementById('aiResults');
            container.innerHTML = mockResults.map((item) => `
                <div class="ai-card flex gap-4" onclick='window.importItem(${JSON.stringify(item).replace(/'/g, "&#39;")})'>
                    <div class="ai-badge">Google + Gemini</div>
                    <img src="${item.img}" class="w-24 h-24 object-contain bg-white rounded border">
                    <div>
                        <div class="font-bold text-lg text-slate-800">${item.name}</div>
                        <div class="text-xs text-gray-500 mb-2">${item.desc.substring(0,60)}...</div>
                        <div class="flex gap-2 mb-2">
                            <span class="text-[10px] bg-gray-200 px-2 rounded">âš–ï¸ ${item.specs.weight}</span>
                            <span class="text-[10px] bg-gray-200 px-2 rounded">ğŸ¨ ${item.specs.cover}</span>
                        </div>
                        <div class="text-blue-600 font-bold text-sm">×œ×—×¥ ×œ×™×™×‘×•× ×•×©×™×¤×•×¨ <i class="fas fa-arrow-left"></i></div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('aiModal').style.display = 'flex';
        };

        function generateMockData(q) {
            const type = q.includes("×“×‘×§") ? "glue" : q.includes("××§×“×—") ? "drill" : "cement";
            const variants = [
                {
                    name: type==="glue" ? "×“×‘×§ ×§×¨××™×§×” ×¤×¨×™××™×•× 114" : "××§×“×—×” ×¨×•×˜×˜×ª Makita HP1630",
                    sku: "AUTO-" + Math.floor(Math.random()*1000),
                    price: type==="glue" ? 65 : 450,
                    img: type==="glue" ? "https://www.jacobi.co.il/wp-content/uploads/2016/09/code-109.jpg" : "https://m.media-amazon.com/images/I/51H5S2uK+pL._AC_SL1000_.jpg",
                    desc: "××•×¦×¨ ××™×›×•×ª×™ ×‘××™×•×—×“ ×œ×¢×‘×•×“×•×ª ××§×¦×•×¢×™×•×ª. ×¢××™×“×•×ª ×’×‘×•×”×” ×œ××•×¨×š ×–××Ÿ.",
                    specs: { weight: "25 ×§×’", cover: "5 ×\"×¨", dry: "4 ×©×¢×•×ª" },
                    cat: type==="drill" ? "tools" : "glue"
                },
                {
                    name: type==="glue" ? "×“×‘×§ ××§×¨×™×œ×™ ×’××™×© Sika" : "×¤×˜×™×©×•×Ÿ × ×˜×¢×Ÿ Bosch 18V",
                    sku: "AUTO-" + Math.floor(Math.random()*1000),
                    price: type==="glue" ? 85 : 890,
                    img: type==="glue" ? "https://gilar.co.il/wp-content/uploads/2019/06/Sika-Ceram-203.jpg" : "https://m.media-amazon.com/images/I/61D7V+h+cUL._AC_SL1500_.jpg",
                    desc: "××ª××™× ×‘××™×•×—×“ ×œ×ª× ××™ ×—×•×¥ ×•×—×“×¨×™× ×¨×˜×•×‘×™×. ×ª×§×Ÿ ××™×¨×•×¤××™ ××—××™×¨.",
                    specs: { weight: "20 ×§×’", cover: "7 ×\"×¨", dry: "24 ×©×¢×•×ª" },
                    cat: type==="drill" ? "tools" : "glue"
                }
            ];
            return variants;
        }

        window.importItem = (item) => {
            document.getElementById('aiModal').style.display = 'none';
            window.openModal();
            document.getElementById('pName').value = item.name;
            document.getElementById('pSku').value = item.sku;
            document.getElementById('pPrice').value = item.price;
            document.getElementById('pCat').value = item.cat;
            document.getElementById('pDesc').value = item.desc;
            document.getElementById('pImg').value = item.img;
            
            document.getElementById('sWeight').value = item.specs.weight;
            document.getElementById('sCover').value = item.specs.cover;
            document.getElementById('sDry').value = item.specs.dry;
            
            window.syncPreview();
        };

        // --- 3. EDITOR LOGIC ---
        window.openModal = () => {
            document.getElementById('productForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('pImg').value = 'https://via.placeholder.com/150';
            document.getElementById('modalTitle').innerText = "××•×¦×¨ ×—×“×©";
            document.getElementById('editModal').style.display = 'flex';
            window.syncPreview();
        };

        window.closeEdit = () => document.getElementById('editModal').style.display = 'none';

        window.editItem = (id) => {
            const p = allProducts.find(x => x.id === id);
            document.getElementById('editId').value = id;
            document.getElementById('modalTitle').innerText = "×¢×¨×™×›×ª ××•×¦×¨";
            
            document.getElementById('pName').value = p.name;
            document.getElementById('pSku').value = p.sku;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pStock').value = p.stock || 0;
            document.getElementById('pCat').value = p.category;
            document.getElementById('pDesc').value = p.desc;
            document.getElementById('pImg').value = p.img;
            
            document.getElementById('sWeight').value = p.specs?.weight || '';
            document.getElementById('sCover').value = p.specs?.cover || '';
            document.getElementById('sDry').value = p.specs?.dry || '';

            document.getElementById('editModal').style.display = 'flex';
            window.syncPreview();
        };

        window.saveProduct = async () => {
            const id = document.getElementById('editId').value;
            const data = {
                name: document.getElementById('pName').value,
                sku: document.getElementById('pSku').value,
                category: document.getElementById('pCat').value,
                price: Number(document.getElementById('pPrice').value),
                stock: Number(document.getElementById('pStock').value),
                img: document.getElementById('pImg').value,
                desc: document.getElementById('pDesc').value,
                specs: {
                    weight: document.getElementById('sWeight').value,
                    cover: document.getElementById('sCover').value,
                    dry: document.getElementById('sDry').value
                },
                updatedAt: serverTimestamp()
            };

            if(id) await updateDoc(doc(db, "products", id), data);
            else { data.createdAt = serverTimestamp(); await addDoc(collection(db, "products"), data); }
            
            window.closeEdit();
        };

        window.deleteItem = async (id) => {
            if(confirm("×œ××—×•×§?")) await deleteDoc(doc(db, "products", id));
        };

        window.syncPreview = () => {
            document.getElementById('prevName').innerText = document.getElementById('pName').value || '×©× ×”××•×¦×¨';
            document.getElementById('prevSku').innerText = document.getElementById('pSku').value || 'SKU';
            document.getElementById('prevPrice').innerText = document.getElementById('pPrice').value || '0';
            const imgUrl = document.getElementById('pImg').value || 'https://via.placeholder.com/150';
            document.getElementById('prevImg').src = imgUrl;
            
            document.getElementById('prevWeight').innerText = document.getElementById('sWeight').value || '-';
            document.getElementById('prevCover').innerText = document.getElementById('sCover').value || '-';
            document.getElementById('prevDry').innerText = document.getElementById('sDry').value || '-';
        };

        window.filterLocal = () => {
            const txt = document.getElementById('localSearch').value.toLowerCase();
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(txt) || p.sku.toLowerCase().includes(txt));
            renderGrid(filtered);
        };

    </script>
</body>
</html>
