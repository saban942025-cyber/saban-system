<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saban Catalog Studio ğŸ›ï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Windows 11 Glass Theme */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.6);
            --primary: #2563eb;
        }
        body { 
            background: linear-gradient(135deg, #f0f4f8 0%, #dbeafe 100%); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #1e293b; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* Layout */
        .studio-layout { 
            display: grid; grid-template-columns: 400px 1fr; gap: 20px; 
            padding: 20px; flex: 1; overflow: hidden; 
        }
        @media (max-width: 1024px) {
            .studio-layout { display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow-y: auto; }
            .panel { height: auto !important; overflow: visible !important; }
            /* Mobile Tabs logic handles visibility */
        }

        /* Glass Panels */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* Google Results Cards */
        .g-card {
            background: white; border-radius: 16px; padding: 12px; margin-bottom: 12px;
            border: 1px solid #e2e8f0; transition: 0.2s; position: relative;
        }
        .g-card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1); }
        
        .g-actions {
            display: flex; gap: 5px; margin-top: 10px; border-top: 1px dashed #e2e8f0; padding-top: 8px;
        }
        .action-btn {
            flex: 1; font-size: 11px; padding: 6px; border-radius: 8px; font-weight: bold;
            display: flex; align-items: center; justify-content: center; gap: 4px; cursor: pointer;
            transition: 0.1s; background: #f8fafc; color: #64748b; border: 1px solid #f1f5f9;
        }
        .action-btn:hover { background: #eff6ff; color: var(--primary); border-color: var(--primary); }
        .action-btn.picked { background: #dcfce7; color: #166534; border-color: #bbf7d0; }

        /* Form Inputs */
        .input-group { margin-bottom: 12px; }
        .input-label { display: block; font-size: 11px; font-weight: 700; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .glass-input {
            width: 100%; padding: 10px 14px; border-radius: 12px; border: 1px solid #cbd5e1;
            background: rgba(255,255,255,0.6); outline: none; transition: 0.2s; font-size: 14px;
        }
        .glass-input:focus { background: white; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Mobile Tabs */
        .mobile-tabs { display: none; }
        @media (max-width: 1024px) {
            .mobile-tabs { display: flex; gap: 10px; margin-bottom: 10px; }
            .tab-btn { flex: 1; padding: 10px; background: white; border-radius: 12px; text-align: center; font-weight: bold; color: #64748b; }
            .tab-btn.active { background: var(--primary); color: white; }
            .hide-mobile { display: none !important; }
        }
    </style>
</head>
<body>

    <header class="h-16 flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-tr from-blue-600 to-indigo-500 rounded-xl flex items-center justify-center text-white text-lg shadow-lg">ğŸ›ï¸</div>
            <div>
                <h1 class="font-bold text-lg text-slate-800 leading-tight">Catalog Studio</h1>
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-wide">××¢×¨×›×ª × ×™×”×•×œ ××•×¦×¨ v5.0</div>
            </div>
        </div>
        <button onclick="saveProduct()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-500/30 flex items-center gap-2 transition active:scale-95">
            <i class="fas fa-save"></i> ×©××•×¨ ××•×¦×¨
        </button>
    </header>

    <div class="px-4 mobile-tabs">
        <button onclick="switchTab('search')" class="tab-btn active" id="btn-search">1. ×—×™×¤×•×© ×‘×¨×©×ª</button>
        <button onclick="switchTab('edit')" class="tab-btn" id="btn-edit">2. ×¢×¨×™×›×ª ××•×¦×¨</button>
    </div>

    <div class="studio-layout">
        
        <div id="panel-search" class="glass-panel panel">
            <div class="p-4 bg-white/50 border-b border-white/50 backdrop-blur-md sticky top-0 z-10">
                <div class="relative">
                    <i class="fab fa-google absolute left-3 top-3.5 text-slate-400"></i>
                    <input id="searchInput" type="text" class="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 shadow-sm focus:ring-2 focus:ring-blue-500 outline-none font-bold" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ (×œ××©×œ: ×¡×™×§×” 107)..." onkeydown="if(event.key==='Enter') runSearch()">
                    <button onclick="runSearch()" class="absolute right-2 top-2 bg-blue-600 text-white p-1.5 rounded-lg text-sm px-3 hover:bg-blue-700">×—×¤×©</button>
                </div>
                <div class="flex justify-between mt-2 text-[10px] text-slate-400 font-bold uppercase">
                    <span>×ª×•×¦××•×ª ××”×¨×©×ª (Mix & Match)</span>
                    <span id="resultsCount">0 ×ª×•×¦××•×ª</span>
                </div>
            </div>

            <div id="resultsList" class="flex-1 overflow-y-auto p-4 custom-scroll space-y-3 bg-slate-50/50">
                <div class="text-center py-20 text-slate-400">
                    <i class="fas fa-globe text-4xl mb-2 opacity-20"></i>
                    <p>×—×¤×© ××•×¦×¨ ×›×“×™ ×œ×”×ª×—×™×œ ×œ×©××•×‘ × ×ª×•× ×™×</p>
                </div>
            </div>
        </div>

        <div id="panel-edit" class="glass-panel panel hide-mobile relative">
            <div class="p-4 border-b border-white/50 bg-white/30 flex justify-between items-center">
                <span class="font-bold text-slate-700"><i class="fas fa-edit text-blue-500"></i> ×¢×¨×™×›×ª ×›×¨×˜×™×¡</span>
                <button onclick="clearForm()" class="text-xs text-red-500 hover:underline">× ×§×” ×˜×•×¤×¡</button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 custom-scroll">
                
                <div class="flex justify-center mb-6 relative group">
                    <img id="previewImg" src="https://via.placeholder.com/200?text=No+Image" class="h-40 w-40 object-contain bg-white rounded-xl border-2 border-dashed border-slate-300 shadow-sm group-hover:border-blue-400 transition">
                    <div class="absolute bottom-0 bg-black/50 text-white text-xs px-2 py-1 rounded mb-2 opacity-0 group-hover:opacity-100 transition">×œ×—×¥ ×¢×œ '×ª××•× ×”' ×‘×ª×•×¦××•×ª</div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="input-label">×©× ××•×¦×¨</label>
                        <input id="inpName" class="glass-input font-bold text-slate-800">
                    </div>
                    <div class="input-group">
                        <label class="input-label">××§"×˜</label>
                        <input id="inpSku" class="glass-input font-mono text-xs">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="input-label">××—×™×¨ ×œ×œ×§×•×— (â‚ª)</label>
                        <input id="inpPrice" type="number" class="glass-input text-green-600 font-bold">
                    </div>
                    <div class="input-group">
                        <label class="input-label">××—×¡×Ÿ (××™×§×•×)</label>
                        <select id="inpWarehouse" class="glass-input">
                            <option value="both">×©× ×™×”× (×”×ª×œ××™×“ + ×”×—×¨×©)</option>
                            <option value="talmid">×”×ª×œ××™×“ ×‘×œ×‘×“</option>
                            <option value="harash">×”×—×¨×© ×‘×œ×‘×“</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">×ª×™××•×¨ ×©×™×•×•×§×™</label>
                    <textarea id="inpDesc" class="glass-input h-24 resize-none leading-relaxed" placeholder="×™×™××©×š ××”×¨×©×ª ××• ×”×§×œ×“ ×™×“× ×™×ª..."></textarea>
                </div>

                <div class="bg-blue-50/80 p-4 rounded-2xl border border-blue-100 mt-4 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs">ğŸ¤–</div>
                        <span class="text-xs font-bold text-blue-800 uppercase">× ×ª×•× ×™× ×œ××•×— (×”×‘×•×˜)</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group">
                            <label class="input-label text-blue-700">×–××Ÿ ×™×™×‘×•×©</label>
                            <input id="inpDrying" class="glass-input bg-white" placeholder="×œ×“×•×’××”: 24 ×©×¢×•×ª">
                        </div>
                        <div class="input-group">
                            <label class="input-label text-blue-700">×©×™×˜×ª ×™×™×©×•×</label>
                            <input id="inpMethod" class="glass-input bg-white" placeholder="×¨×•×œ×¨ / ×©×¤×›×˜×œ">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group">
                            <label class="input-label text-blue-700">××©×§×œ</label>
                            <input id="inpWeight" class="glass-input bg-white" placeholder="25 ×§''×’">
                        </div>
                        <div class="input-group">
                            <label class="input-label text-blue-700">×•×™×“××• (Youtube)</label>
                            <input id="inpVideo" class="glass-input bg-white text-xs">
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- Config ---
        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        let app, db; try{app=initializeApp(firebaseConfig);db=getFirestore(app);}catch(e){}

        // --- API Keys (Live) ---
        const GOOGLE_API_KEY = "AIzaSyDLkShn6lBBew-PJJWtzvAe_14UF9Kv-QI";
        const GOOGLE_CX = "3331a7d5c75e14f26";

        // --- Search Logic ---
        window.runSearch = async () => {
            const query = document.getElementById('searchInput').value;
            if(!query) return;
            
            const list = document.getElementById('resultsList');
            list.innerHTML = '<div class="text-center py-10"><i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i><div class="text-xs text-slate-400 mt-2">×¡×•×¨×§ ××ª ×”××™× ×˜×¨× ×˜...</div></div>';

            try {
                // Fetching web results (rich snippets)
                const url = `https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${GOOGLE_CX}&q=${encodeURIComponent(query)}`;
                const response = await fetch(url);
                const data = await response.json();

                if(!data.items) {
                    list.innerHTML = '<div class="text-center text-slate-400">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';
                    return;
                }

                document.getElementById('resultsCount').innerText = `${data.items.length} ×ª×•×¦××•×ª`;
                
                // Render Cards with Mix & Match Buttons
                list.innerHTML = data.items.map((item, index) => {
                    const img = item.pagemap?.cse_image?.[0]?.src || item.pagemap?.og_image?.[0]?.src || 'https://via.placeholder.com/150?text=No+Img';
                    const title = item.title;
                    const snippet = item.snippet;
                    const link = item.link; // Good for video check
                    
                    const isVideo = link.includes('youtube.com') || link.includes('youtu.be');

                    return `
                    <div class="g-card fade-in" style="animation-delay: ${index * 0.05}s">
                        <div class="flex gap-3">
                            <img src="${img}" class="w-16 h-16 rounded-lg object-cover border border-slate-100 bg-white">
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-xs text-slate-800 line-clamp-2 leading-tight mb-1" title="${title}">${title}</div>
                                <div class="text-[10px] text-slate-500 line-clamp-2 leading-tight">${snippet}</div>
                            </div>
                        </div>
                        
                        <div class="g-actions">
                            <button class="action-btn" onclick="takeField(this, 'name', '${escapeVal(title)}')">
                                <i class="fas fa-tag"></i> ×©×
                            </button>
                            <button class="action-btn" onclick="takeField(this, 'desc', '${escapeVal(snippet)}')">
                                <i class="fas fa-align-left"></i> ×ª×™××•×¨
                            </button>
                            <button class="action-btn" onclick="takeField(this, 'img', '${img}')">
                                <i class="fas fa-image"></i> ×ª××•× ×”
                            </button>
                            ${isVideo ? `<button class="action-btn text-red-500 border-red-100 bg-red-50" onclick="takeField(this, 'video', '${link}')"><i class="fab fa-youtube"></i> ×•×™×“××•</button>` : ''}
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (e) {
                console.error(e);
                list.innerHTML = `<div class="text-red-500 text-center text-xs p-4">×©×’×™××”: ${e.message}</div>`;
            }
        };

        // --- Mix & Match Logic ---
        window.takeField = (btn, type, value) => {
            // Visual Feedback
            const allBtns = btn.parentElement.querySelectorAll('.action-btn');
            allBtns.forEach(b => b.classList.remove('picked'));
            btn.classList.add('picked');

            // Fill Form
            if (type === 'name') document.getElementById('inpName').value = value;
            if (type === 'desc') {
                const current = document.getElementById('inpDesc').value;
                document.getElementById('inpDesc').value = current ? current + "\n\n" + value : value;
                
                // Try to extract technical data from snippet regex
                if(value.includes('×§"×’')) {
                    const match = value.match(/(\d+)\s*×§"?×’/);
                    if(match) document.getElementById('inpWeight').value = match[0];
                }
                if(value.includes('×©×¢×•×ª') || value.includes('×™×™×‘×•×©')) document.getElementById('inpDrying').value = "×‘×“×•×§ ×‘×ª×™××•×¨"; 
            }
            if (type === 'img') document.getElementById('previewImg').src = value;
            if (type === 'video') document.getElementById('inpVideo').value = value;

            // Mobile Auto-Switch (Optional UX)
            if(window.innerWidth < 1024) {
               // Toast notification instead of switching tab strictly
               // alert('×”×©×“×” ×¢×•×“×›×Ÿ!');
            }
        };

        function escapeVal(str) {
            return str.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
        }

        // --- Tabs (Mobile) ---
        window.switchTab = (tab) => {
            document.getElementById('panel-search').classList.add('hide-mobile');
            document.getElementById('panel-edit').classList.add('hide-mobile');
            document.getElementById(`panel-${tab}`).classList.remove('hide-mobile');
            
            document.getElementById('btn-search').classList.remove('active');
            document.getElementById('btn-edit').classList.remove('active');
            document.getElementById(`btn-${tab}`).classList.add('active');
        };

        // --- CRUD ---
        window.clearForm = () => {
            document.querySelectorAll('input, textarea').forEach(i => i.value = '');
            document.getElementById('previewImg').src = 'https://via.placeholder.com/200?text=No+Image';
            document.getElementById('inpWarehouse').value = 'both';
        };

        window.saveProduct = async () => {
            if(!db) return alert("××™×Ÿ ×—×™×‘×•×¨ ×œ×©×¨×ª");
            
            const product = {
                core: {
                    name: document.getElementById('inpName').value,
                    sku: document.getElementById('inpSku').value,
                    price: document.getElementById('inpPrice').value,
                    warehouse: document.getElementById('inpWarehouse').value
                },
                rich: {
                    description: document.getElementById('inpDesc').value,
                    image: document.getElementById('previewImg').src,
                    video_url: document.getElementById('inpVideo').value
                },
                chatbot: {
                    drying_time: document.getElementById('inpDrying').value,
                    application_method: document.getElementById('inpMethod').value,
                    weight: document.getElementById('inpWeight').value
                },
                updatedAt: new Date()
            };

            if(!product.core.name) return alert("×—×•×‘×” ×œ××œ× ×©× ××•×¦×¨");

            try {
                await addDoc(collection(db, "products"), product);
                alert("××•×¦×¨ × ×©××¨ ×‘×”×¦×œ×—×”! ×”×‘×•×˜ ×¢×•×“×›×Ÿ. ğŸ§ ");
                window.clearForm();
            } catch(e) {
                console.error(e);
                alert("×©×’×™××” ×‘×©××™×¨×”");
            }
        };

    </script>
</body>
</html>
