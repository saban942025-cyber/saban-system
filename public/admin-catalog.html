<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saban Catalog Workstation (Live) ğŸ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Windows 11 / Glass Theme */
        :root {
            --glass: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.8);
            --primary: #2563eb;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        body { background: var(--bg-gradient); font-family: 'Segoe UI', system-ui, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; color: #1e293b; }

        /* Layout */
        .workspace { display: grid; grid-template-columns: 350px 1fr 320px; gap: 15px; padding: 15px; height: 100%; overflow: hidden; }
        
        /* Panels */
        .panel {
            background: var(--glass); backdrop-filter: blur(20px);
            border: 1px solid white; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .panel-header { padding: 15px; border-bottom: 1px solid #f1f5f9; font-weight: bold; display: flex; justify-content: space-between; align-items: center; background: white; }
        .panel-content { flex: 1; overflow-y: auto; padding: 15px; }

        /* Search Results (Source) */
        .g-result {
            background: white; border: 1px solid #e2e8f0; border-radius: 12px;
            padding: 10px; margin-bottom: 10px; transition: 0.2s;
        }
        .g-result:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(37, 99, 235, 0.1); }
        .g-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 8px; }
        .g-btn {
            font-size: 10px; padding: 6px; background: #f8fafc; border: 1px solid #e2e8f0;
            border-radius: 6px; cursor: pointer; color: #64748b; font-weight: 600;
            display: flex; align-items: center; justify-content: center; gap: 4px;
        }
        .g-btn:hover { background: #eff6ff; color: var(--primary); border-color: var(--primary); }
        .g-btn.picked { background: #dcfce7; color: #15803d; border-color: #86efac; }

        /* Editor Forms */
        .form-section { margin-bottom: 15px; background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #f1f5f9; }
        .form-title { font-size: 11px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
        .inp-group { margin-bottom: 10px; }
        .inp-label { font-size: 11px; font-weight: 700; color: #475569; margin-bottom: 3px; display: block; }
        .inp {
            width: 100%; padding: 8px 12px; border-radius: 8px; border: 1px solid #cbd5e1;
            font-size: 13px; outline: none; transition: 0.2s; background: white;
        }
        .inp:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        /* Image Placeholders */
        .img-slot {
            height: 100px; border: 2px dashed #cbd5e1; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; position: relative; background: #f1f5f9; cursor: pointer;
        }
        .img-slot img { width: 100%; height: 100%; object-fit: contain; }
        .img-slot:hover { border-color: var(--primary); }
        .img-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; font-size: 10px; text-align: center; padding: 2px; }

        /* Preview Card */
        .card-preview {
            background: white; border-radius: 16px; border: 1px solid #e2e8f0;
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .brand-logo-preview {
            width: 40px; height: 40px; border-radius: 50%; border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); object-fit: cover; background: white;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>

    <header class="h-14 bg-white/80 backdrop-blur border-b flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center text-white text-lg shadow">ğŸ’</div>
            <div>
                <h1 class="font-bold text-slate-800 leading-none">Catalog Workstation</h1>
                <div class="text-[10px] text-green-600 font-bold uppercase">××—×•×‘×¨ ×œ×¨×©×ª (Live)</div>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="clearForm()" class="text-slate-500 hover:text-red-500 font-bold text-xs">× ×§×” ×˜×•×¤×¡</button>
            <button onclick="saveProduct()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold shadow-lg transition text-sm flex items-center gap-2">
                <i class="fas fa-save"></i> ×©××•×¨ ××•×¦×¨
            </button>
        </div>
    </header>

    <div class="workspace">
        
        <div class="panel">
            <div class="panel-header text-blue-600">
                <span><i class="fab fa-google"></i> ×—×™×¤×•×© ×‘×¨×©×ª</span>
            </div>
            <div class="p-3 bg-white border-b">
                <div class="relative">
                    <input id="searchInput" class="inp font-bold" placeholder="×”×§×œ×“ ××•×¦×¨ (×œ××©×œ: ×“×‘×§ ×§×¨××™×§×”)..." onkeydown="if(event.key==='Enter') runSearch()">
                    <button onclick="runSearch()" class="absolute left-2 top-1.5 text-blue-600 hover:bg-blue-50 p-1 rounded"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div id="resultsList" class="panel-content custom-scroll bg-slate-50">
                <div class="text-center py-10 text-slate-400">
                    <i class="fas fa-globe text-3xl mb-2 opacity-20"></i>
                    <p class="text-xs">×”×§×œ×“ ×•×œ×—×¥ Enter ×œ×—×™×¤×•×© ×—×™</p>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header text-slate-700">
                <span><i class="fas fa-edit"></i> ×¢×¨×™×›×ª × ×ª×•× ×™×</span>
                <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">×˜×•×¤×¡ ×—×›×</span>
            </div>
            <div class="panel-content custom-scroll">
                
                <div class="form-section grid grid-cols-3 gap-3">
                    <div class="col-span-3 form-title"><i class="fas fa-images"></i> ××“×™×” ×•××•×ª×’</div>
                    
                    <div class="img-slot h-24" id="slotMain">
                        <img id="imgMain" src="https://via.placeholder.com/150?text=Main" class="opacity-50">
                        <div class="img-label">×¨××©×™×ª</div>
                    </div>
                    <div class="img-slot h-24" id="slotSec">
                        <img id="imgSec" src="https://via.placeholder.com/150?text=Sec" class="opacity-50">
                        <div class="img-label">××©× ×™×ª</div>
                    </div>
                    <div class="img-slot h-24 rounded-full w-24 mx-auto border-2" id="slotBrand">
                        <img id="imgBrand" src="https://via.placeholder.com/150?text=Logo" class="opacity-50">
                        <div class="img-label">×œ×•×’×•</div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-title"><i class="fas fa-info-circle"></i> ×¤×¨×˜×™ ××•×¦×¨</div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="inp-group">
                            <label class="inp-label">×©× ××•×¦×¨</label>
                            <input id="inpName" class="inp font-bold" oninput="updatePreview()">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">××§"×˜</label>
                            <input id="inpSku" class="inp font-mono text-xs" oninput="updatePreview()">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="inp-group">
                            <label class="inp-label">××—×™×¨ ×œ×œ×§×•×— (â‚ª)</label>
                            <input id="inpPrice" type="number" class="inp text-green-600 font-bold" oninput="updatePreview()">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">×©× ××•×ª×’ (×˜×§×¡×˜)</label>
                            <input id="inpBrandName" class="inp" placeholder="×œ××©×œ: Makita" oninput="updatePreview()">
                        </div>
                    </div>
                    <div class="inp-group">
                        <label class="inp-label">××™×§×•× ×‘××œ××™</label>
                        <select id="inpStock" class="inp" onchange="updatePreview()">
                            <option value="both">âœ… ×”×—×¨×© + ×”×ª×œ××™×“</option>
                            <option value="harash">ğŸ“ ×”×—×¨×© ×‘×œ×‘×“</option>
                            <option value="talmid">ğŸ“ ×”×ª×œ××™×“ ×‘×œ×‘×“</option>
                        </select>
                    </div>
                </div>

                <div class="form-section bg-indigo-50 border-indigo-100">
                    <div class="form-title text-indigo-600"><i class="fas fa-robot"></i> × ×ª×•× ×™× ×œ×‘×•×˜</div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="inp-group">
                            <label class="inp-label">×–××Ÿ ×™×™×‘×•×©</label>
                            <input id="inpDry" class="inp" placeholder="24 ×©×¢×•×ª">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">×©×™×˜×ª ×™×™×©×•×</label>
                            <input id="inpMethod" class="inp" placeholder="×¨×•×œ×¨/××¨×™×ª">
                        </div>
                    </div>
                    <div class="inp-group">
                        <label class="inp-label">××©×§×œ / ××¨×™×–×”</label>
                        <input id="inpWeight" class="inp" placeholder="×©×§ 25 ×§''×’">
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-title"><i class="fas fa-align-left"></i> ×ª×•×›×Ÿ ×¢×©×™×¨</div>
                    <div class="inp-group">
                        <label class="inp-label">×ª×™××•×¨ / ××¤×¨×˜</label>
                        <textarea id="inpDesc" class="inp h-24 resize-none" placeholder="×”×¢×ª×§ ××”×¨×©×ª..."></textarea>
                    </div>
                    <div class="inp-group">
                        <label class="inp-label">×§×™×©×•×¨ ×•×™×“××• (Youtube)</label>
                        <input id="inpVideo" class="inp text-xs text-blue-600">
                    </div>
                </div>

            </div>
        </div>

        <div class="panel bg-slate-100">
            <div class="panel-header text-slate-500">
                <span><i class="fas fa-eye"></i> ×ª×¦×•×’×” ××§×“×™××”</span>
            </div>
            <div class="panel-content flex flex-col items-center justify-center">
                
                <div class="card-preview w-full bg-white relative">
                    <div class="absolute top-3 right-3 z-10" title="×œ×—×¥ ×¢×œ ×”××•×ª×’ ×œ×¡×™× ×•×Ÿ">
                        <img id="prevBrandLogo" src="" class="brand-logo-preview hidden">
                    </div>

                    <div class="h-48 bg-white flex items-center justify-center p-4 border-b border-slate-50 relative group">
                        <img id="prevImgMain" src="https://via.placeholder.com/200?text=Preview" class="h-full object-contain transition group-hover:scale-105">
                        <div class="absolute bottom-2 left-2 w-10 h-10 border bg-white rounded shadow p-0.5">
                            <img id="prevImgSec" src="" class="w-full h-full object-cover opacity-50">
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5" id="prevBrandName">BRAND</div>
                                <div class="font-bold text-slate-800 text-sm leading-tight line-clamp-2" id="prevName">×©× ××•×¦×¨</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-green-600 text-lg" id="prevPrice">â‚ª0</div>
                            </div>
                        </div>

                        <div class="text-[10px] text-slate-400 mb-3 font-mono" id="prevSku">SKU-000</div>

                        <div class="flex gap-1 mb-4 text-[10px] font-bold" id="prevStock">
                            </div>

                        <div class="grid grid-cols-2 gap-2">
                            <button class="bg-slate-100 text-slate-600 py-2 rounded-lg text-xs font-bold hover:bg-slate-200">×œ×¡×œ ×”×§× ×™×•×ª</button>
                            <button class="bg-blue-600 text-white py-2 rounded-lg text-xs font-bold hover:bg-blue-700">×¤×¨×˜×™× × ×•×¡×¤×™×</button>
                        </div>
                    </div>
                </div>

                <div class="mt-6 text-center text-xs text-slate-400 max-w-[200px]">
                    <i class="fas fa-info-circle mb-1"></i>
                    <p>×›×š ×™×¨××” ×›×¨×˜×™×¡ ×”××•×¦×¨ ×‘××¤×œ×™×§×¦×™×”. ×”×œ×•×’×• ×œ××¢×œ×” ×œ×—×™×¥ ×•×™×¡× ×Ÿ ××•×¦×¨×™× ×œ×¤×™ ××•×ª×’.</p>
                </div>

            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- Config ---
        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        let app, db; try{app=initializeApp(firebaseConfig);db=getFirestore(app);}catch(e){}

        // --- KEYS (Embedded) ---
        const GOOGLE_API_KEY = "AIzaSyDLkShn6lBBew-PJJWtzvAe_14UF9Kv-QI";
        const GOOGLE_CX = "3331a7d5c75e14f26";

        // --- Logic ---

        window.runSearch = async () => {
            const query = document.getElementById('searchInput').value;
            if(!query) return;
            
            const list = document.getElementById('resultsList');
            list.innerHTML = '<div class="text-center py-10"><i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i><div class="mt-2 text-xs">×¡×•×¨×§...</div></div>';

            try {
                // ×§×¨×™××” ×××™×ª×™×ª ×œ×’×•×’×œ
                const url = `https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${GOOGLE_CX}&q=${encodeURIComponent(query)}`;
                const res = await fetch(url);
                const data = await res.json();

                if(!data.items) { list.innerHTML = '<div class="text-center text-slate-400">×œ× × ××¦××• ×ª×•×¦××•×ª</div>'; return; }

                list.innerHTML = data.items.map(item => {
                    // ×—×™×œ×•×¥ ×ª××•× ×” ××™×›×•×ª×™×ª ×›×›×œ ×”××¤×©×¨
                    const img = item.pagemap?.cse_image?.[0]?.src || item.pagemap?.og_image?.[0]?.src || '';
                    const title = item.title;
                    const snippet = item.snippet;
                    const link = item.link;
                    const isVideo = link.includes('youtube') || link.includes('youtu.be');

                    return `
                    <div class="g-result">
                        <div class="flex gap-2 mb-2">
                            ${img ? `<img src="${img}" class="w-12 h-12 rounded object-cover border">` : ''}
                            <div class="min-w-0">
                                <div class="font-bold text-xs text-slate-800 line-clamp-1" title="${title}">${title}</div>
                                <div class="text-[10px] text-slate-500 line-clamp-2">${snippet}</div>
                            </div>
                        </div>
                        <div class="g-actions">
                            <button class="g-btn" onclick="takeField(this, 'mainImg', '${img}')"><i class="fas fa-image"></i> ×¨××©×™×ª</button>
                            <button class="g-btn" onclick="takeField(this, 'secImg', '${img}')"><i class="fas fa-images"></i> ××©× ×™×ª</button>
                            <button class="g-btn" onclick="takeField(this, 'brandLogo', '${img}')"><i class="fas fa-copyright"></i> ×œ×•×’×•</button>
                            <button class="g-btn" onclick="takeField(this, 'desc', '${escapeVal(snippet)}')"><i class="fas fa-align-right"></i> ×ª×™××•×¨</button>
                            <button class="g-btn" onclick="takeField(this, 'name', '${escapeVal(title)}')"><i class="fas fa-tag"></i> ×©×</button>
                            ${isVideo ? `<button class="g-btn text-red-600" onclick="takeField(this, 'video', '${link}')"><i class="fab fa-youtube"></i> ×•×™×“××•</button>` : ''}
                        </div>
                    </div>`;
                }).join('');
            } catch(e) { list.innerHTML = `<div class="text-red-500 text-xs text-center">${e.message}</div>`; }
        };

        window.takeField = (btn, type, val) => {
            // Animation Feedback
            btn.classList.add('picked');
            setTimeout(()=>btn.classList.remove('picked'), 500);

            // Logic: ×”×¢×‘×¨×ª ××™×“×¢ ××”×¨×©×ª ×œ×©×“×•×ª
            if(type === 'mainImg') { document.getElementById('imgMain').src = val; document.getElementById('prevImgMain').src = val; }
            if(type === 'secImg') { document.getElementById('imgSec').src = val; document.getElementById('prevImgSec').src = val; }
            if(type === 'brandLogo') { 
                document.getElementById('imgBrand').src = val; 
                document.getElementById('prevBrandLogo').src = val; 
                document.getElementById('prevBrandLogo').classList.remove('hidden'); 
            }
            if(type === 'name') { document.getElementById('inpName').value = val; window.updatePreview(); }
            if(type === 'desc') document.getElementById('inpDesc').value += val + '\n';
            if(type === 'video') document.getElementById('inpVideo').value = val;
        };

        window.updatePreview = () => {
            document.getElementById('prevName').innerText = document.getElementById('inpName').value || '×©× ××•×¦×¨';
            document.getElementById('prevSku').innerText = document.getElementById('inpSku').value || 'SKU';
            document.getElementById('prevPrice').innerText = `â‚ª${document.getElementById('inpPrice').value || 0}`;
            document.getElementById('prevBrandName').innerText = document.getElementById('inpBrandName').value || 'BRAND';

            const stock = document.getElementById('inpStock').value;
            const sDiv = document.getElementById('prevStock');
            if(stock==='both') sDiv.innerHTML = '<span class="bg-green-100 text-green-700 px-1.5 rounded">×—×¨×©</span><span class="bg-blue-100 text-blue-700 px-1.5 rounded">×ª×œ××™×“</span>';
            else if(stock==='harash') sDiv.innerHTML = '<span class="bg-green-100 text-green-700 px-1.5 rounded">×—×¨×© ×‘×œ×‘×“</span>';
            else sDiv.innerHTML = '<span class="bg-blue-100 text-blue-700 px-1.5 rounded">×ª×œ××™×“ ×‘×œ×‘×“</span>';
        };

        window.clearForm = () => {
            document.querySelectorAll('input, textarea').forEach(i => i.value='');
            document.getElementById('imgMain').src = 'https://via.placeholder.com/150?text=Main';
            document.getElementById('imgSec').src = 'https://via.placeholder.com/150?text=Sec';
            document.getElementById('imgBrand').src = 'https://via.placeholder.com/150?text=Logo';
            document.getElementById('prevBrandLogo').classList.add('hidden');
            updatePreview();
        };

        window.saveProduct = async () => {
            if(!db) return alert("××™×Ÿ ×—×™×‘×•×¨ ×œ×©×¨×ª (×‘×“×•×§ ××™× ×˜×¨× ×˜)");
            
            const product = {
                core: {
                    name: document.getElementById('inpName').value,
                    sku: document.getElementById('inpSku').value,
                    price: Number(document.getElementById('inpPrice').value),
                    brand: document.getElementById('inpBrandName').value,
                    brandLogo: document.getElementById('imgBrand').src
                },
                logistics: {
                    warehouse: document.getElementById('inpStock').value,
                    weight: document.getElementById('inpWeight').value
                },
                rich: {
                    description: document.getElementById('inpDesc').value,
                    mainImage: document.getElementById('imgMain').src,
                    secondaryImage: document.getElementById('imgSec').src,
                    video: document.getElementById('inpVideo').value
                },
                chatbot: {
                    drying_time: document.getElementById('inpDry').value,
                    application_method: document.getElementById('inpMethod').value
                },
                updatedAt: new Date()
            };
            
            if(!product.core.name) return alert("×—×•×‘×” ×œ××œ× ×©× ××•×¦×¨!");

            try {
                await addDoc(collection(db, "products"), product);
                alert("××•×¦×¨ × ×©××¨ ×‘×”×¦×œ×—×”! ğŸ’¾");
                window.clearForm();
            } catch(e) { console.error(e); alert("×©×’×™××” ×‘×©××™×¨×”: " + e.message); }
        };

        function escapeVal(str) { return str.replace(/'/g, "").replace(/"/g, ""); }
        
        // Init
        updatePreview();

    </script>
</body>
</html>
