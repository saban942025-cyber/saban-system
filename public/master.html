<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SabanOS | מרכז שליטה</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-900 min-h-screen font-sans text-white">

    <nav class="bg-slate-800 p-4 shadow-lg border-b border-slate-700 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <i class="fas fa-crown text-yellow-400 text-2xl"></i>
            <h1 class="text-xl font-bold">SabanOS Master</h1>
        </div>
        <button onclick="window.location.href='index.html'" class="text-gray-400 hover:text-white">יציאה</button>
    </nav>

    <main class="p-8 max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        
        <a href="dispatch.html" class="bg-gray-800 p-6 rounded-xl border-l-4 border-blue-600 hover:bg-gray-700 transition">
            <h2 class="text-xl font-bold text-blue-400 mb-2"><i class="fas fa-tower-observation"></i> מגדל פיקוח</h2>
            <p class="text-xs text-gray-400">ניהול סידור עבודה</p>
        </a>

        <a href="admin.html" class="bg-gray-800 p-6 rounded-xl border-l-4 border-purple-600 hover:bg-gray-700 transition">
            <h2 class="text-xl font-bold text-purple-400 mb-2"><i class="fas fa-database"></i> ניהול קטלוג</h2>
            <p class="text-xs text-gray-400">עריכת מוצרים ומלאי</p>
        </a>

        <div class="bg-gray-800 p-6 rounded-xl border-l-4 border-green-500 col-span-1 md:col-span-2">
            <h2 class="text-xl font-bold text-green-400 mb-4"><i class="fas fa-user-secret"></i> התחזות ללקוח (Client View)</h2>
            <div class="flex gap-2">
                <select id="clientSelect" class="bg-gray-900 border border-gray-600 text-white p-3 rounded w-full">
                    <option value="">טוען לקוחות...</option>
                </select>
                <button onclick="impersonateClient()" class="bg-green-600 hover:bg-green-500 px-6 py-2 rounded font-bold whitespace-nowrap">כנס</button>
            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // טעינת רשימת לקוחות להתחזות
        (async () => {
            const select = document.getElementById('clientSelect');
            // מביא את כל המשתמשים שיש להם role=client או סתם את כולם
            const q = query(collection(db, "users")); 
            const snapshot = await getDocs(q);
            
            select.innerHTML = '<option value="">בחר לקוח להתחזות...</option>';
            snapshot.forEach(doc => {
                const u = doc.data();
                if(u.role !== 'admin') { // לא נתחזה לאדמין
                    const opt = document.createElement('option');
                    opt.value = doc.id; // UID
                    opt.innerText = `${u.name} (${u.email || u.phone})`;
                    select.appendChild(opt);
                }
            });
            
            // הוספת משתמש דמו למקרה שאין
            const demo = document.createElement('option');
            demo.value = "shahar_shaul";
            demo.innerText = "שחר שאול (Demo)";
            select.appendChild(demo);
        })();

        window.impersonateClient = () => {
            const uid = document.getElementById('clientSelect').value;
            if (!uid) return alert("בחר לקוח");
            
            // שמירת המזהה והעברה
            localStorage.setItem('impersonateId', uid);
            window.location.href = "client.html";
        };
    </script>
</body>
</html>
