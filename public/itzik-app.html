<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>住祝 专砖 | 爪拽 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', system-ui, sans-serif; padding-bottom: 80px; }
        
        /* Header */
        .header-bg { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); height: 160px; border-radius: 0 0 30px 30px; position: relative; padding: 20px; color: white; box-shadow: 0 4px 20px rgba(249, 115, 22, 0.3); }
        .profile-section { position: absolute; bottom: -30px; left: 0; right: 0; text-align: center; }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: inline-block; object-fit: cover; background: white; }
        
        /* Quick Actions Grid */
        .action-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 50px 20px 20px 20px; }
        .action-card { background: white; border-radius: 16px; padding: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; transition: 0.2s; cursor: pointer; }
        .action-card:active { transform: scale(0.95); background: #fff7ed; }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 0 auto 10px; }
        
        /* Request List */
        .list-header { display: flex; justify-content: space-between; align-items: center; padding: 0 25px; margin-top: 10px; }
        .req-item { background: white; margin: 10px 20px; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-right: 4px solid #cbd5e1; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .req-pending { border-right-color: #f59e0b; }
        .req-approved { border-right-color: #22c55e; }
        
        /* Staff Bar */
        .staff-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px; scrollbar-width: none; }
        .staff-chip { background: white; padding: 5px 12px; border-radius: 20px; border: 1px solid #e2e8f0; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
        .dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; }

    </style>
</head>
<body>

    <div class="header-bg">
        <div class="flex justify-between items-start">
            <div>
                <div class="text-sm opacity-80">砖,  住祝</div>
                <div class="text-2xl font-bold">爪拽 </div>
            </div>
            <div class="bg-white/20 p-2 rounded-lg backdrop-blur-sm cursor-pointer" onclick="window.location.reload()">
                <i class="fas fa-sync-alt"></i>
            </div>
        </div>
        
        <div class="profile-section">
            <img src="https://media-mrs2-2.cdn.whatsapp.net/v/t61.24694-24/138846705_247951546693089_6505800604178808158_n.jpg?stp=dst-jpg_s96x96_tt6&ccb=11-4&oh=01_Q5Aa3QE_Teyw4quA6Pany4Hj8a0LOLkFxWWSd7r__aOsnJSAug&oe=695B1F10&_nc_sid=5e03e0&_nc_cat=105" class="profile-img">
        </div>
    </div>

    <div class="action-grid">
        <div class="action-card" onclick="openRequestModal('transport')">
            <div class="icon-box bg-blue-50 text-blue-600"><i class="fas fa-truck-moving"></i></div>
            <div class="font-bold text-slate-700">  拽</div>
            <div class="text-xs text-gray-400">拽砖 专 </div>
        </div>

        <div class="action-card" onclick="openRequestModal('transfer')">
            <div class="icon-box bg-purple-50 text-purple-600"><i class="fas fa-exchange-alt"></i></div>
            <div class="font-bold text-slate-700">注专 住祝</div>
            <div class="text-xs text-gray-400">砖 住专 转</div>
        </div>

        <div class="action-card" onclick="openRequestModal('supplier')">
            <div class="icon-box bg-orange-50 text-orange-600"><i class="fas fa-box-open"></i></div>
            <div class="font-bold text-slate-700">住祝 住驻拽</div>
            <div class="text-xs text-gray-400">拽砖  转/专砖</div>
        </div>

        <div class="action-card" onclick="alert('  ')">
            <div class="icon-box bg-green-50 text-green-600"><i class="fas fa-file-invoice-dollar"></i></div>
            <div class="font-bold text-slate-700"> / 砖转</div>
            <div class="text-xs text-gray-400"> /专</div>
        </div>
    </div>

    <div class="px-5 text-xs font-bold text-gray-400 mb-2">爪转 专砖 (专)</div>
    <div class="staff-scroll">
        <div class="staff-chip"><div class="dot"></div> </div>
        <div class="staff-chip"><div class="dot"></div> 专 (爪专)</div>
        <div class="staff-chip"><div class="dot"></div> 砖 (驻拽)</div>
        <div class="staff-chip border-dashed text-gray-400"><div class="dot bg-gray-300"></div>  ( 专)</div>
    </div>

    <div class="list-header">
        <h3 class="font-bold text-lg text-slate-800">拽砖转 驻转转</h3>
        <span class="text-xs bg-gray-200 px-2 py-1 rounded-full text-gray-600" id="req-count">0</span>
    </div>
    
    <div id="requests-list" class="pb-10">
        <div class="text-center text-gray-400 mt-10 text-sm"> 拽砖转 驻转转 专注</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));
        
        // --- 1. Request Logic ---
        window.openRequestModal = (type) => {
            let title = '', placeholder = '';
            
            if(type === 'transport') { title = '转 砖转 拽'; placeholder = '注专 ? ?  住专?'; }
            if(type === 'transfer') { title = '砖转 住专 (转)'; placeholder = ' 驻专 住专? 驻转?'; }
            if(type === 'supplier') { title = '拽砖转 住祝 住驻拽'; placeholder = ' 住驻拽?  ?'; }

            Swal.fire({
                title: title,
                input: 'textarea',
                inputPlaceholder: placeholder,
                showCancelButton: true,
                confirmButtonText: '砖 住专 ',
                confirmButtonColor: '#f97316',
                preConfirm: (text) => {
                    if(!text) Swal.showValidationMessage(' 驻专 转 拽砖');
                    return text;
                }
            }).then(async (result) => {
                if(result.isConfirmed) {
                    // 爪专转 砖 砖拽驻爪转 专 砖专
                    await addDoc(collection(db, "orders"), {
                        clientName: `住祝 专砖 (${type === 'transfer' ? '注专' : ''})`,
                        text: result.value,
                        isTask: true, //  砖 驻转
                        taskType: type === 'transport' ? 'urgent' : 'transfer', // 爪注 住专
                        status: 'new',
                        branch: 'harash', // 砖 住祝
                        requester: '爪拽 ',
                        lastActive: serverTimestamp(),
                        createdAt: serverTimestamp()
                    });

                    Swal.fire('砖!', '拽砖 注专 专/ 住专', 'success');
                }
            });
        };

        // --- 2. Live List ---
        //  拽砖转 砖爪拽 驻转
        const q = query(collection(db, "orders"), where("requester", "==", "爪拽 "), where("status", "!=", "done"), orderBy("createdAt", "desc"));
        
        onSnapshot(q, (snap) => {
            const list = document.getElementById('requests-list');
            document.getElementById('req-count').innerText = snap.size;
            list.innerHTML = '';

            if(snap.empty) {
                list.innerHTML = '<div class="text-center text-gray-400 mt-10 text-sm"> 拽,  拽砖转 驻转转.</div>';
                return;
            }

            snap.forEach(doc => {
                const r = doc.data();
                const statusColor = r.status === 'new' ? 'req-pending' : 'req-approved';
                const statusText = r.status === 'new' ? '转 砖抓' : (r.driverId ? `驻 注" ${r.driverId}` : '驻');
                
                list.innerHTML += `
                <div class="req-item ${statusColor}">
                    <div>
                        <div class="font-bold text-slate-700 text-sm">${r.clientName}</div>
                        <div class="text-xs text-gray-500 mt-1">${r.text}</div>
                    </div>
                    <div class="text-center">
                        <div class="text-[10px] font-bold bg-gray-100 px-2 py-1 rounded mb-1">${statusText}</div>
                        <div class="text-[10px] text-gray-400">${new Date(r.createdAt.seconds*1000).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</div>
                    </div>
                </div>`;
            });
        });

    </script>
</body>
</html>
