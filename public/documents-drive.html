<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive</title>
    
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) { await OneSignal.init({ appId: "07b81f2e-e812-424f-beca-36584b12ccf2" }); });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-slate-50 p-4">

    <div class="flex justify-between items-center mb-4">
        <h1 class="font-bold text-lg text-slate-700">ארכיון מסמכים</h1>
        <button onclick="showHelp()" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-sm">
            <i class="fas fa-plus"></i> הוסף חדש
        </button>
    </div>

    <div id="doc-grid" class="grid grid-cols-2 gap-4">
        <div class="col-span-2 text-center text-gray-400 mt-10">
            <i class="fas fa-circle-notch fa-spin text-2xl mb-2"></i><br>טוען נתונים...
        </div>
    </div>

    <script>
        // >>> הכתובת החדשה שלך מהפריסה האחרונה <<<
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw6tU2yOXn4BkP3xwlmgB8nKU-8u6BOSKXTXJjXsY9E86E_zYXpa9_aDxsPmd63X1Wd/exec";

        function showHelp() {
            Swal.fire({
                title: 'הוספת מסמך מקומקס',
                html: `
                    <div class="text-right text-sm">
                        <p class="mb-3">שלח את הקובץ (PDF/תמונה) למייל הבא:</p>
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-3 text-center">
                            <div class="font-mono font-bold text-blue-800 select-all">saban942025@gmail.com</div>
                        </div>
                        <p class="text-xs text-green-600 font-bold text-center"><i class="fas fa-check-circle"></i> יופיע כאן אוטומטית!</p>
                    </div>
                `,
                confirmButtonText: 'הבנתי',
                confirmButtonColor: '#2563eb'
            });
        }
        
        async function loadFiles() {
            try {
                const res = await fetch(SCRIPT_URL);
                const files = await res.json();
                const grid = document.getElementById('doc-grid');
                grid.innerHTML = '';

                if(files.length === 0) {
                    grid.innerHTML = '<div class="col-span-2 text-center text-gray-400">אין מסמכים להצגה</div>';
                    return;
                }

                files.forEach(f => {
                    const icon = f.type && f.type.includes('image') ? 'fa-file-image text-blue-500' : 'fa-file-pdf text-red-500';
                    const date = f.date ? new Date(f.date).toLocaleDateString() : '...';
                    
                    grid.innerHTML += `
                    <div class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center text-center cursor-pointer" onclick="window.open('${f.url}', '_blank')">
                        <i class="fas ${icon} text-3xl mb-2"></i>
                        <div class="text-xs font-bold text-slate-700 break-all line-clamp-2">${f.name || 'ללא שם'}</div>
                        <div class="text-[10px] text-gray-400 mt-1">${date}</div>
                    </div>`;
                });
            } catch(e) {
                document.getElementById('doc-grid').innerHTML = '<div class="col-span-2 text-center text-red-400">שגיאה בטעינת נתונים</div>';
            }
        }

        loadFiles();
        // setTimeout(showHelp, 1500); // אופציונלי: הקפצה בטעינה
    </script>
</body>
</html>
