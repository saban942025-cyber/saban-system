<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saban OS | Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --wa-main-bg: #efeae2; --wa-header: #f0f2f5; --wa-green: #008069; --wa-border: #d1d7db; }
        body { margin: 0; padding: 0; height: 100vh; overflow: hidden; font-family: -apple-system, sans-serif; background-color: #d1d7db; display: flex; align-items: center; justify-content: center; }

        .app-container { width: 100%; height: 100%; max-width: 1920px; background: white; display: flex; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 65px; background: #f0f2f5; border-left: 1px solid var(--wa-border); display: flex; flex-direction: column; align-items: center; padding-top: 15px; gap: 8px; z-index: 20; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
        .sidebar:hover { width: 260px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }

        /* Profile */
        .profile-section { display: flex; align-items: center; gap: 12px; padding: 12px; width: 100%; justify-content: center; margin-bottom: 10px; overflow: hidden; white-space: nowrap; transition: 0.3s; }
        .sidebar:hover .profile-section { justify-content: flex-start; background: #e9edef; }
        .profile-img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--wa-green); flex-shrink: 0; }
        .profile-text { opacity: 0; transition: opacity 0.2s; color: #111b21; }
        .sidebar:hover .profile-text { opacity: 1; }

        /* Nav Buttons */
        .nav-btn { width: 92%; height: 52px; display: flex; align-items: center; border-radius: 8px; cursor: pointer; color: #54656f; transition: all 0.2s; padding: 0 12px; white-space: nowrap; overflow: hidden; position: relative; }
        .nav-btn:hover { background: #f5f6f6; color: #111b21; }
        .nav-btn.active { background: #e9edef; color: var(--wa-green); font-weight: 600; }
        .nav-btn.active::before { content: ''; position: absolute; right: 0; top: 10%; bottom: 10%; width: 4px; background: var(--wa-green); border-radius: 4px 0 0 4px; }
        .nav-icon { width: 24px; font-size: 20px; text-align: center; margin-left: 16px; flex-shrink: 0; transition: 0.2s; }
        .nav-label { opacity: 0; transition: opacity 0.2s; font-size: 15px; }
        .sidebar:hover .nav-label { opacity: 1; }
        
        /* Main Content */
        .main-content { flex: 1; display: flex; flex-direction: column; background: var(--wa-main-bg); position: relative; }
        .main-content::before { content: ''; position: absolute; inset: 0; opacity: 0.4; background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png"); pointer-events: none; z-index: 0; }
        .content-header { height: 60px; background: var(--wa-header-bg); border-bottom: 1px solid var(--wa-border); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; z-index: 10; }
        .iframe-wrapper { flex: 1; position: relative; z-index: 1; background: transparent; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
    </style>
</head>
<body>

    <div class="app-container">
        
        <nav class="sidebar">
            <div class="profile-section">
                <div class="relative group">
                    <img id="my-avatar" src="https://ui-avatars.com/api/?name=Guest&background=gray" class="profile-img">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 border-2 border-white rounded-full" id="conn-dot"></div>
                </div>
                <div class="profile-text">
                    <div class="font-bold text-sm text-slate-800" id="my-name">××•×¨×— (×œ× ××–×•×”×”)</div>
                    <div class="text-[11px] text-gray-500 font-bold" id="my-role">×œ×—×¥ ×¢×œ ×œ×™× ×§ ×”×”×ª×§× ×”</div>
                </div>
            </div>

            <div class="nav-btn active" onclick="loadTool('sidor-group.html', '×§×‘×•×¦×ª ×¡×™×“×•×¨ (Live Feed)', this)">
                <i class="fas fa-users nav-icon text-green-700"></i><span class="nav-label font-bold">×§×‘×•×¦×ª ×¡×™×“×•×¨</span>
            </div>
            <div class="nav-btn" onclick="loadTool('hamal-ops.html', '××¤×” ×˜×§×˜×™×ª ×•××‘×¦×¢×™×', this)">
                <i class="fas fa-map-marked-alt nav-icon text-slate-600"></i><span class="nav-label">××‘×¦×¢×™× (××¤×”)</span>
            </div>
            <div class="nav-btn" onclick="loadTool('transfers.html', '×”×¢×‘×¨×•×ª ×‘×™×Ÿ ×¡× ×™×¤×™×', this)">
                <i class="fas fa-dolly nav-icon text-orange-600"></i><span class="nav-label">×”×¢×‘×¨×•×ª ××œ××™</span>
            </div>
            <div class="nav-btn" onclick="loadTool('hamal-manager.html', '×”××•×— ×”×—×›×', this)">
                <i class="fas fa-brain nav-icon text-purple-600"></i><span class="nav-label">×”××•×— (×—×™×–×•×™)</span>
            </div>

            <div class="w-[80%] h-[1px] bg-gray-300 mx-auto my-2 opacity-50"></div>

            <div class="nav-btn" onclick="loadTool('admin-team.html', '× ×™×”×•×œ ×¦×•×•×ª ×•×”×¨×©××•×ª', this)">
                <i class="fas fa-users-cog nav-icon text-indigo-600"></i><span class="nav-label">× ×™×”×•×œ ×¦×•×•×ª</span>
            </div>
            <div class="nav-btn" onclick="loadTool('admin-god.html', '×œ×™× ×§×™× ×œ×œ×§×•×—×•×ª', this)">
                <i class="fas fa-link nav-icon text-blue-500"></i><span class="nav-label">×œ×™× ×§×™× ×œ×œ×§×•×—×•×ª</span>
            </div>

            <div class="nav-btn mt-auto mb-2" onclick="loadTool('driver-pro.html', '××‘×˜ × ×”×’', this)">
                <i class="fas fa-truck nav-icon text-slate-400"></i><span class="nav-label text-slate-500">××‘×˜ × ×”×’</span>
            </div>
        </nav>

        <main class="main-content">
            <header class="content-header">
                <div class="flex items-center gap-4">
                    <div id="page-icon" class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-500 shadow-sm"><i class="fas fa-users"></i></div>
                    <div>
                        <h2 id="page-title" class="font-bold text-gray-800 text-base">×§×‘×•×¦×ª ×¡×™×“×•×¨ (Live Feed)</h2>
                        <p class="text-xs text-green-600">â— ××•× ×œ×™×™×Ÿ</p>
                    </div>
                </div>
                <div class="flex gap-5 text-gray-500 text-lg">
                    <button class="hover:text-green-600"><i class="fas fa-search"></i></button>
                    <button class="hover:text-green-600"><i class="fas fa-ellipsis-v"></i></button>
                </div>
            </header>
            <div class="iframe-wrapper">
                <iframe id="app-frame" src="sidor-group.html" allow="geolocation; microphone; camera"></iframe>
            </div>
        </main>
    </div>

    <script>
        // --- 1. ×–×™×”×•×™ ××©×ª××© (Onboarding) ---
        const urlParams = new URLSearchParams(window.location.search);
        const userIdFromLink = urlParams.get('user_id');

        if (userIdFromLink) {
            localStorage.setItem('saban_user_id', userIdFromLink);
            window.history.replaceState({}, document.title, window.location.pathname);
            Swal.fire({ title: '××¢×¨×›×ª ×¡×‘×Ÿ', text: '×”×”×ª×§× ×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”!', icon: 'success', timer: 2000, showConfirmButton: false });
        }

        const myId = localStorage.getItem('saban_user_id');
        if(myId) {
            // ×›××Ÿ ×”××¢×¨×›×ª "×™×•×“×¢×ª" ××™ ×”××©×ª××© ×•××¢×“×›× ×ª ××ª ×”×ª×¦×•×’×”
            // (×‘×¤×•×¢×œ × ×“×¨×©×ª ×©×œ×™×¤×” ××”-DB, ×›××Ÿ × ×“××” ×–×™×”×•×™ ××”×™×¨)
            document.getElementById('conn-dot').classList.replace('bg-gray-400', 'bg-green-500');
            document.getElementById('my-name').innerText = "××©×ª××© ××—×•×‘×¨"; 
            document.getElementById('my-role').innerText = "××–×”×”: " + myId.slice(0,5);
        }

        // --- 2. ×× ×’× ×•×Ÿ ×”×”×ª×¨××•×ª (Nagging Alert) ---
        // ×¤×•× ×§×¦×™×” ×–×• × ×§×¨××ª ××ª×•×š ×”××™×™×¤×¨×™×™× (sidor-group)
        window.triggerUrgentAlert = (msg) => {
            console.log("ğŸ”¥ URGENT ALERT TRIGGERED:", msg);

            // ×¦×œ×™×œ
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/933/933-preview.m4a');
            audio.loop = true;
            audio.play().catch(e => console.log("Audio requires interaction"));

            // ×¨×˜×˜ (×¢×•×‘×“ ×‘××•×‘×™×™×œ)
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 1000]); 
                var vibInterval = setInterval(() => navigator.vibrate([500, 200, 500]), 2000);
            }

            Swal.fire({
                title: 'âš ï¸ ××©×™××” ×“×—×•×¤×”!',
                text: msg,
                icon: 'warning',
                confirmButtonText: '×§×™×‘×œ×ª×™, ××˜×¤×œ!',
                confirmButtonColor: '#d33',
                allowOutsideClick: false,
                backdrop: `rgba(255,0,0,0.5)`
            }).then(() => {
                audio.pause();
                if(window.vibInterval) clearInterval(window.vibInterval);
                navigator.vibrate(0);
            });
        };

        // --- 3. × ×™×•×•×˜ ---
        function loadTool(filename, title, btnElement) {
            document.getElementById('page-title').innerText = title;
            const iconClass = btnElement.querySelector('i').className;
            document.getElementById('page-icon').innerHTML = `<i class="${iconClass} text-lg"></i>`;
            
            const frame = document.getElementById('app-frame');
            frame.style.opacity = '0';
            setTimeout(() => {
                frame.src = filename;
                frame.onload = () => { frame.style.opacity = '1'; };
            }, 100);

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
        }
    </script>
</body>
</html>
