<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××•×— (Gemini Test) ğŸ§ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; font-family: system-ui; height: 100vh; display: flex; flex-direction: column; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 15px; border-radius: 20px; max-width: 80%; line-height: 1.5; font-size: 15px; animation: fadeIn 0.3s; }
        .bot { background: white; color: #333; border: 1px solid #e5e7eb; border-top-right-radius: 4px; }
        .user { background: #2563eb; color: white; align-self: flex-end; border-top-left-radius: 4px; }
        .sys { text-align: center; font-size: 12px; color: gray; margin: 10px 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="bg-white p-4 border-b flex items-center justify-between shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-tr from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-xl">âœ¨</div>
            <div>
                <h1 class="font-bold">Chat-Saban AI</h1>
                <div class="text-xs text-green-600 font-bold flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-green-600"></span> ××—×•×‘×¨ ×œ-Gemini
                </div>
            </div>
        </div>
        <button onclick="location.reload()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-sync"></i></button>
    </div>

    <div id="chatBox" class="chat-container">
        <div class="sys">×”××¢×¨×›×ª ××•×›× ×”. × ×¡×” ×œ×©××•×œ ×©××œ×”...</div>
    </div>

    <div class="p-4 bg-white border-t flex gap-2">
        <input type="text" id="userIn" class="flex-1 bg-gray-100 p-3 rounded-xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="×©××œ ××©×”×• (×œ××©×œ: ××™×š ××•×˜××™× ×’×’?)..." onkeydown="if(event.key==='Enter') sendMsg()">
        <button onclick="sendMsg()" class="bg-blue-600 text-white w-12 h-12 rounded-xl flex items-center justify-center shadow-lg hover:bg-blue-700 transition">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>

    <script type="module">
        // 1. ×™×™×‘×•× ×”×× ×•×¢ ×©×‘× ×™× ×•
        import { SabanChatbot } from './js/chatbot-engine.js';
        
        // 2. ×—×™×‘×•×¨ ×œ-Firebase (×›×“×™ ×©×”×‘×•×˜ ×™×•×›×œ ×œ×§×¨×•× ××œ××™)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0", storageBucket: "saban94-eb5f0.firebasestorage.app", messagingSenderId: "656829273946", appId: "1:656829273946:web:8ebcb440ed280aff014563" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 3. ××ª×—×•×œ ×”×‘×•×˜
        const userContext = { name: "×¨××™ ×”×× ×›\"×œ" }; // ×”×‘×•×˜ ×™×“×¢ ×©×”×•× ××“×‘×¨ ××™×ª×š
        const bot = new SabanChatbot(db, userContext);

        // 4. ×œ×•×’×™×§×ª ×”×¦'××˜
        window.sendMsg = async () => {
            const input = document.getElementById('userIn');
            const txt = input.value;
            if(!txt) return;

            // ×”×¦×’×ª ×”×•×“×¢×ª ××©×ª××©
            addBubble(txt, 'user');
            input.value = '';

            // ×—×™×•×•×™ "××§×œ×™×“..."
            const loadingId = addBubble('ğŸ¤– ×—×•×©×‘...', 'bot');
            
            try {
                // --- ×›××Ÿ ×”×§×¡× ×§×•×¨×”: ×©×œ×™×—×” ×œ××•×— ---
                const response = await bot.ask(txt);
                
                // ×”×¡×¨×ª ×”"××§×œ×™×“" ×•×”×¦×’×ª ×”×ª×©×•×‘×”
                document.getElementById(loadingId).remove();
                addBubble(response.text, 'bot');
                
            } catch (e) {
                console.error(e);
                document.getElementById(loadingId).innerText = "×©×’×™××” ×‘×—×™×‘×•×¨ ×œ××•×— ğŸ”´";
            }
        };

        function addBubble(text, type) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            const id = 'msg-' + Date.now();
            div.id = id;
            div.className = `bubble ${type}`;
            
            // ×”××¨×ª ×›×•×›×‘×™×•×ª ×œ×”×“×’×©×” (×›××• ×©×’×•×’×œ ××—×–×™×¨ ×œ×¤×¢××™×)
            div.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
            return id;
        }
    </script>
</body>
</html>
