<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Saban Hamal PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; color: white; height: 100vh; overflow: hidden; font-family: sans-serif; }
        .sidebar { width: 300px; background: #1e293b; border-left: 1px solid #334155; display: flex; flex-direction: column; }
        .main-area { flex: 1; display: flex; flex-direction: column; background: #0f172a; }
        .order-item { padding: 15px; border-bottom: 1px solid #334155; cursor: pointer; transition: 0.2s; }
        .order-item:hover, .order-item.active { background: #334155; border-right: 4px solid #3b82f6; }
        .status-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body class="flex">

    <div class="sidebar">
        <div class="p-4 border-b border-gray-700 font-bold text-xl flex justify-between">
            <span>×—×"×œ ×¡×‘×Ÿ ğŸ›¡ï¸</span>
            <span class="text-xs bg-blue-600 px-2 py-1 rounded">PRO</span>
        </div>
        <div class="p-2">
            <input type="text" placeholder="×—×¤×© ×”×–×× ×” / ×œ×§×•×—..." class="w-full bg-slate-900 border border-slate-700 p-2 rounded text-sm text-white outline-none">
        </div>
        <div id="orders-list" class="flex-1 overflow-y-auto">
            </div>
    </div>

    <div class="main-area relative">
        <div id="empty-state" class="flex flex-col items-center justify-center h-full opacity-30">
            <i class="fas fa-truck-loading text-6xl mb-4"></i>
            <h2 class="text-2xl">×‘×—×¨ ×”×–×× ×” ×œ×˜×™×¤×•×œ</h2>
        </div>

        <div id="detail-view" class="hidden h-full flex flex-col">
            <div class="bg-slate-800 p-4 border-b border-slate-700 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold" id="view-client">...</h2>
                    <div class="text-sm opacity-60">×”×–×× ×”: <span id="view-id">...</span> | ×ª××¨×™×š: <span id="view-date">...</span></div>
                </div>
                <div class="flex gap-3">
                    <button class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded font-bold" onclick="updateComax()">
                        <i class="fas fa-keyboard"></i> ×¢×“×›×Ÿ ××¡' ×§×•××§×¡
                    </button>
                    <button class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded font-bold" onclick="markDone()">
                        <i class="fas fa-check"></i> ×¡×’×•×¨ ×˜×™×¤×•×œ
                    </button>
                </div>
            </div>

            <div class="flex-1 flex overflow-hidden">
                <div class="w-1/3 p-6 border-l border-slate-700 overflow-y-auto">
                    <h3 class="font-bold text-lg mb-4 text-blue-400">×¡×˜×˜×•×¡ ×˜×™×¤×•×œ</h3>
                    
                    <div class="space-y-6 relative border-r-2 border-slate-700 pr-4 mr-2">
                        <div class="relative">
                            <div class="w-3 h-3 bg-green-500 rounded-full absolute -right-[23px] top-1.5"></div>
                            <div class="font-bold">×”×ª×§×‘×œ×” ××”××¤×œ×™×§×¦×™×”</div>
                            <div class="text-xs opacity-50">10:00 â€¢ ×™×•×¡×™ ×›×”×Ÿ</div>
                        </div>
                        <div class="relative opacity-50" id="step-comax">
                            <div class="w-3 h-3 bg-slate-600 rounded-full absolute -right-[23px] top-1.5"></div>
                            <div class="font-bold">×”×•×§×œ×“ ×‘×§×•××§×¡</div>
                            <div class="text-xs text-yellow-500">×××ª×™×Ÿ ×œ×”×§×œ×“×”...</div>
                        </div>
                        <div class="relative opacity-50" id="step-pdf">
                            <div class="w-3 h-3 bg-slate-600 rounded-full absolute -right-[23px] top-1.5"></div>
                            <div class="font-bold">××¡××š PDF ×”×ª×§×‘×œ</div>
                            <div class="text-xs">×××ª×™×Ÿ ×œ××™×™×œ ××•×˜×•××˜×™</div>
                        </div>
                    </div>

                    <div class="mt-8 p-4 bg-slate-800 rounded-xl">
                        <h4 class="font-bold mb-2">×¤×¨×™×˜×™× ×‘×”×–×× ×”</h4>
                        <ul class="text-sm space-y-1 opacity-80" id="items-list"></ul>
                    </div>
                </div>

                <div class="flex-1 bg-slate-900 p-4 flex flex-col">
                    <div id="pdf-container" class="flex-1 bg-slate-800 rounded-xl border-2 border-dashed border-slate-600 flex items-center justify-center text-slate-500">
                        <div class="text-center">
                            <i class="fas fa-file-pdf text-4xl mb-2"></i>
                            <p>××™×Ÿ ×¢×“×™×™×Ÿ ××¡××š ××§×•××§×¡</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyA3qwgBX69Clu7pUdOnOEcfzUVyR7ADrNc", authDomain: "saban94-eb5f0.firebaseapp.com", projectId: "saban94-eb5f0" }));
        let currentOrderId = null;

        // Load Orders
        onSnapshot(query(collection(db, "orders"), orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('orders-list');
            list.innerHTML = "";
            snap.forEach(d => {
                const o = d.data();
                const statusColor = o.status === 'done' ? 'bg-green-500' : (o.pdfUrl ? 'bg-yellow-500' : 'bg-blue-500');
                
                list.innerHTML += `
                <div class="order-item" onclick="openOrder('${d.id}', '${o.clientName}')">
                    <div class="flex justify-between mb-1">
                        <span class="font-bold">${o.clientName}</span>
                        <span class="status-badge ${statusColor} text-black">${o.status}</span>
                    </div>
                    <div class="text-xs opacity-60">×”×–×× ×” #${o.orderNum || '---'}</div>
                </div>`;
            });
        });

        window.openOrder = (id, name) => {
            currentOrderId = id;
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('detail-view').classList.remove('hidden');
            document.getElementById('view-client').innerText = name;
            document.getElementById('view-id').innerText = id.substring(0,6);
            
            // ×‘××¦×™××•×ª ×›××Ÿ × ××©×•×š × ×ª×•× ×™× ×‘×–××Ÿ ×××ª ×œ×¢×“×›×•×Ÿ ×”-PDF ×•×”×¡×˜×˜×•×¡
        };

        window.updateComax = async () => {
            const num = prompt("×”×›× ×¡ ××¡×¤×¨ ×”×–×× ×” ××§×•××§×¡:");
            if(num) await updateDoc(doc(db, "orders", currentOrderId), { comaxNum: num, status: 'processing' });
        };
    </script>
</body>
</html>
